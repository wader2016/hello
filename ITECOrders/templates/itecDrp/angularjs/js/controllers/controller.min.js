/*! test 05-04-2016 */
MetronicApp.controller("AccountSettingController",function(a,b,c,d,e,f,g,h){a.loginName=c.authentication.userName,b.get("http://"+d+"/Api/api/v1/UserProfile").success(function(e){a.userInfo=e.Data,"null"==a.userInfo.ContactInfo&&(c.logOut(),f.url("/Login/login/html")),a.ContactInfoDetail=JSON.parse(a.userInfo.ContactInfo),a.realName=a.ContactInfoDetail.Name,a.Tel=a.ContactInfoDetail.Tel1,a.loginEmail=a.ContactInfoDetail.Email1,g.Nick=a.ContactInfoDetail.Nick,a.MainAddressInfo=JSON.parse(a.userInfo.MainAddressInfo),a.StoreInfo=JSON.parse(a.userInfo.StoreInfo),b.get("http://"+d+"/Api/api/v1/Store").success(function(b){if(a.mapAddress=b.Data,null!=a.StoreInfo)for(var c=0;c<a.mapAddress.length;c++)a.mapAddress[c].StoreId==a.StoreInfo.Id&&(a.mapAdd=a.mapAddress[c],mapFun(a.mapAdd));else a.mapAdd=a.mapAddress[0],mapFun(a.mapAdd)}),a.userId=a.ContactInfoDetail.Id,a.Identity=a.userInfo.Identity,a.AddressInfo=JSON.parse(a.userInfo.AddressInfo);for(var h=0;h<a.AddressInfo.length;h++){a.AddressInfo[h].defaultSet=!1,a.AddressInfo[h].Id==a.MainAddressInfo[0].Id&&(a.AddressInfo[h].defaultSet=!0);var i=JSON.parse(a.AddressInfo[h].StrExt2),j=a.AddressInfo[h].AddressLine2,k="",l="";-1!=j.lastIndexOf("区")?(k=j.substring(0,j.lastIndexOf("区")+1),l=j.substring(j.lastIndexOf("区")+1)):-1!=j.lastIndexOf("县")?(k=j.substring(0,j.lastIndexOf("县")+1),l=j.substring(j.lastIndexOf("县")+1)):-1!=j.lastIndexOf("旗")?(k=j.substring(0,j.lastIndexOf("旗")+1),l=j.substring(j.lastIndexOf("旗")+1)):-1!=j.lastIndexOf("市")&&(k=j.substring(0,j.lastIndexOf("市")+1),l=j.substring(j.lastIndexOf("市")+1)),a.AddressInfo[h].addDetail=k,a.AddressInfo[h].area=l,a.AddressInfo[h].TelAndPhone=i}if(null!=a.userInfo.PaymentInfo){a.PaymentInfo=a.userInfo.PaymentInfo.split("|"),a.payInfo=[];for(var m=0;m<a.PaymentInfo.length;m++){var n=a.PaymentInfo[m].split(":")[1];a.payInfo.push(n)}a.CardNumber=a.payInfo[0],a.CardName=a.payInfo[1],a.IdCard=a.payInfo[2],a.CardPhone=a.payInfo[3]}a.InvoiceInfo=JSON.parse(a.userInfo.InvoiceInfo),null!=a.InvoiceInfo?(a.invoiceId=a.InvoiceInfo.Id,a.invoiceName=a.InvoiceInfo.Name,a.invoiceNumber=a.InvoiceInfo.Code,a.invoiceAddressAndPhone=a.InvoiceInfo.AddressLine,a.bankLine=a.InvoiceInfo.BankLine):a.invoiceId=0,b.get("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/MarketInfo").success(function(b){if(a.marketInfo=b.Data,null!=a.marketInfo){a.marketId=a.marketInfo.Id,a.birthDay=a.marketInfo.Birthday.substring(0,a.marketInfo.Birthday.indexOf(" ")),a.bikeClub=a.marketInfo.ClubInfo,a.checkItem=a.marketInfo.PurchaseIntention;for(var c=0;c<a.purchase.length;c++)a.purchase[c].intention==a.checkItem&&(a.checkId=a.purchase[c].Id);a.checkSaleItem=a.marketInfo.SalesInfoChannel;for(var d=0;d<a.SalesInfoChannel.length;d++)a.SalesInfoChannel[d].channel==a.checkSaleItem&&(a.checkSalesId=a.SalesInfoChannel[d].Id)}else a.marketId=0})}).error(function(){c.logOut(),f.url("/Login/login/html")}),a.saveForm=function(){var c={Id:a.userId,Name:a.realName,Tel:a.Tel,Nick:a.Nick};b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/ContactInfo",c).success(function(){g.Nick=a.Nick,alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})},a.updatePwd=function(){a.newPassword==a.confirmPassword?b.post("http://192.168.1.10:8083/api/account/ChangePassword",{UserName:a.loginName,CurrentPassword:a.password,NewPassword:a.newPassword}).success(function(){alertInfo.Success("密码修改成功!"),c.logOut(),i()}).error(function(){alertInfo.Error("修改失败!")}):alertInfo.Error("两次密码不一致!")};var i=function(){var a=e(function(){e.cancel(a),f.path("/login")},2e3)};a.getImg=function(){var b=document.getElementsByTagName("img");g.headImg=b[4].src,h.set(a.loginName+"image",g.headImg),alertInfo.Success("保存成功!")},b.get("/data/ProJson.json").success(function(b){a.getProvince=b}),b.get("/data/CityJson.json").success(function(b){a.City=b}),b.get("/data/DistrictJson.json").success(function(b){a.Street=b}),a.getCity=[],a.getProData=function(b){if(a.getCity=[],a.selCity=[],a.selStreet=[],null!=b){a.selectProvince=b.ProName;for(var c=0;c<a.City.length;c++)a.selProvince.ProID==a.City[c].ProID&&a.getCity.push(a.City[c])}},a.getStreet=[],a.getCityData=function(b){if(a.getStreet=[],a.selStreet=0,null!=b){a.selectCity=b.CityName;for(var c=0;c<a.Street.length;c++)a.selCity.CityID==a.Street[c].CityID&&a.getStreet.push(a.Street[c])}},a.getStreetData=function(b){null!=b&&(a.selectStreet=b.DisName)},a.defaultCheck=!1,a.setDefault=function(){},a.isChecked=function(a){return!!a},a.saveInfo=function(){null==a.listId&&(a.listId=0);var c={Id:a.listId,ContactWay:{Consignee:a.acceptName,Tel:a.telNumber,Phone:a.phoneNum},Province:a.selectProvince,City:a.selectCity,Street:a.selectStreet,AddressLine1:"",ZipCode:a.codeNum,AddressLine2:a.selectProvince+a.selectCity+a.selectStreet+a.detailAddress,DefaultAddress:a.defaultCheck},e={Name:a.acceptName,addDetail:a.selectProvince+a.selectCity+a.selectStreet,AddressLine2:a.selectProvince+a.selectCity+a.selectStreet+a.detailAddress,ZipCode:a.codeNum,TelAndPhone:{Tel:a.telNumber,Phone:a.phoneNum},defaultSet:a.defaultCheck};if(c.DefaultAddress)for(var f=0;f<a.AddressInfo.length;f++)a.AddressInfo[f].defaultSet=!1;b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/AddressInfo",c).success(function(){0==c.Id?a.AddressInfo.push(e):a.AddressInfo.splice(a.listIndex,1,e),alertInfo.Success("保存成功！"),a.defaultCheck=!1,j()}).error(function(){alertInfo.Error("保存失败!")})};var j=function(){a.selProvince="",a.selCity="",a.selStreet="",a.acceptName="",a.phoneNum="",a.telNumber="",a.codeNum="",a.detailAddress="",a.defaultCheck=!1};a.updateInfo=function(b){a.listId=a.AddressInfo[b].Id,a.listIndex=b,a.acceptName=a.AddressInfo[b].Name,a.phoneNum=a.AddressInfo[b].TelAndPhone.Phone,a.telNumber=a.AddressInfo[b].TelAndPhone.Tel,a.codeNum=a.AddressInfo[b].ZipCode,a.detailAddress=a.AddressInfo[b].area,a.defaultCheck=a.AddressInfo[b].defaultSet,a.selectProvince=a.AddressInfo[b].Province,a.selectCity=a.AddressInfo[b].City,a.selectStreet=a.AddressInfo[b].Street},a.viewModal=function(b){a.delIndex=b},a.deleteInfo=function(){b["delete"]("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/"+a.AddressInfo[a.delIndex].Id).success(function(){}),a.AddressInfo.splice(a.delIndex,1)},a.showDefault=function(b){if(0==a.AddressInfo[b].defaultSet){for(var c=0;c<a.AddressInfo.length;c++)a.AddressInfo[c].showSet=!1;a.AddressInfo[b].showSet=!0}},a.hideDefault=function(){for(var b=0;b<a.AddressInfo.length;b++)a.AddressInfo[b].showSet=!1},a.changeAddress=function(c){for(var e=0;e<a.AddressInfo.length;e++)a.AddressInfo[e].showSet=!1,a.AddressInfo[e].defaultSet=!1;b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/Address/"+a.AddressInfo[c].Id).success(function(){a.AddressInfo[c].defaultSet=!0,alertInfo.Success("修改成功!")}).error(function(){alertInfo.Error("修改失败!")})},a.bankInfo=function(){var c={CardNo:a.CardNumber,Name:a.CardName,Identity:a.IdCard,Tel:a.CardPhone};b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/PayInfo",c).success(function(){alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})},a.invoiceInfo=function(){var c={Id:a.invoiceId,Name:a.invoiceName,AddressLine:a.invoiceAddressAndPhone,Code:a.invoiceNumber,BankLine:a.bankLine};b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/InvoiceInfo",c).success(function(){alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("更新失败!")})},a.saveAddress=function(){b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/Store/"+a.mapAdd.StoreId).success(function(){alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})},a.getMap=function(b){a.mapAdd=b,mapFun(b)},a.purchase=[{intention:"自己使用",Id:0,"for":"self"},{intention:"送朋友",Id:1,"for":"friend"},{intention:"收藏",Id:2,"for":"collection"},{intention:"其他",Id:3,"for":"else"}],a.SalesInfoChannel=[{channel:"偶然发现",Id:0,"for":"find"},{channel:"朋友介绍",Id:1,"for":"command"},{channel:"店铺推荐",Id:2,"for":"prefer"},{channel:"其他",Id:3,"for":"something"}],a.checkPurchase=function(b,c){a.checkId=c,a.checkItem=b.intention},a.checkChannel=function(b,c){a.checkSalesId=c,a.checkSaleItem=b.channel},a.saveSaleInfo=function(){var c={Id:a.marketId,Birthday:a.birthDay,ClubInfo:a.bikeClub,PurchaseIntention:a.checkItem,SalesInfoChannel:a.checkSaleItem};b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/MarketInfo",c).success(function(){alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})}}),MetronicApp.controller("AllDeliveryOrderController",["$scope","ModelService","$http","apiUrl","$filter",function(a,b,c,d,e){b.getCategory().success(function(b){a.category=b.Data}).error(function(){}),a.isShowList=!0,a.ShowList=function(){a.isShowList=!a.isShowList},a.isShow=!0,a.packUpDown=function(){a.isShow=!a.isShow};var f=new Date;a.DocDateFrom=e("dateFilter")(f),a.DocDateTo=e("dateToFilter")(f),c.get("http://"+d+"/Api/api/DeliveryOrder?state=0*1*2*3").success(function(b){a.items1=b.Data}).error(function(){}),c.get("http://"+d+"/Api/api/DeliveryOrder?state=0*1*2*3").success(function(b){a.items=b.Data,a.sellName=a.items;for(var c=0;c<a.sellName.length-1;c++)for(var d=c+1;d<a.sellName.length;d++)a.sellName[c].CarrierContactName==a.sellName[d].CarrierContactName&&(a.sellName.splice(d,1),d--)}).error(function(){})}]),MetronicApp.controller("AllOrderController",["$scope","$http","ModelService","apiUrl","$filter",function(a,b,c,d,e){c.getData("21*22*23*24*25*26*27*28").success(function(b){if(null===b.ErrMessage){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1;a.len=a.items.length,a.totalPage=Math.ceil(a.len/a.pageSize),a.listCount=a.items.slice(0,a.pageSize)}}),c.getCategory().success(function(b){a.category=b.Data,a.catelog=[];for(var c=0;c<a.category.length;c++)if(0==a.category[c].ParentCode){a.category[c].module=[];for(var d=0;d<a.category.length;d++)a.category[d].ParentCode==a.category[c].Id&&a.category[c].module.push(a.category[d]);a.catelog.push(a.category[c])}}).error(function(){}),a.isShowList=!0,a.ShowList=function(){a.isShowList=!a.isShowList},a.isShow=!0,a.packUpDown=function(){a.isShow=!a.isShow};var f=new Date;a.DocDateFrom=e("dateFilter")(f),a.DocDateTo=e("dateToFilter")(f),a.searchList=function(c){var d="http://192.168.1.47/Api/api/SalesOrder?state="+c;if(null!==a.DocDateFrom){var e=a.DocDateFrom.split("-").join("");d=d+"dateFrom="+e}else d+="dateFrom";if(null!==a.DocDateTo){var f=a.DocDateTo.split("-").join("");d=d+"&dateTo="+f}else d+="&dateTo";if(null!==a.ProductCode){var g=a.ProductCode;d=d+"&productCode="+g}else d+="&productCode";if(null!==a.BuyerAccountName){var h=a.BuyerAccountName;d=d+"&buyerAccountName="+h}else d+="&buyerAccountName";b.get(d).success(function(b){a.items=b.Data}).error(function(){a.items=[]})},a.checkListItem=[],a.checkItems=function(c){a.checkListItem.push(c);for(var e=0;e<a.checkListItem.length-1;e++)a.checkListItem[e].CatalogName==c.CatalogName&&(a.checkListItem.splice(e,1),a.checkListItem.splice(a.checkListItem.length-1,1));for(var f=[],g=0;g<a.checkListItem.length;g++)f.push(a.checkListItem[g].CatalogId);var h=f.join("*");b.get("http://"+d+"/Api/api/SalesOrder?state=21*22*23*24*25*26*27*28&catalog="+h).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1;a.listCount=a.items.slice(0,a.pageSize)})},a.stuckConfirm=function(){if(a.List.length>0)for(var b=0;b<a.List.length;b++)a.listCount[b].isCheck=!1,a.listCount[b].SalesOrdreLineState="2"},a.test=function(b){a.list=a.listCount[b]},a.Confirm=function(){a.list.SalesOrderLineState="2",b.get("http://192.168.1.47/Api/api/SalesOrderLine?id="+a.list.Id).success(function(a){a.State="2",b.put("http://192.168.1.47/Api/api/SalesOrderLine",a).success(function(){alert("ok")}).error(function(){alert("失败")})})},a.List=[],a.CheckElement=function(b){a.listCount[b].isCheck===!1?(a.List.splice(0,0,a.listCount[b]),a.listCount[b].isCheck=!0):a.listCount[b].isCheck===!0&&(a.listCount[b].isCheck=!1,a.List.splice(b,1))},a.checkAll=function(){for(var b=0;b<a.listCount.length;b++)a.listCount[b].isCheck===!1?(a.List.splice(0,0,a.listCount[b]),a.listCount[b].isCheck=!0):a.listCount[b].isCheck===!0&&(a.listCount[b].isCheck=!1,a.List=[])},a.currentPage=1,a.pages=[1,2,3,4,5],a.pageSize=10,a.setPage=function(b,c){a.listCount=a.items.slice((b-1)*c,b*c),a.currentPage<=5&&(a.pages=[1,2,3,4,5]),a.currentPage>5&&(a.pages=[a.currentPage-4,a.currentPage-3,a.currentPage-2,a.currentPage-1,a.currentPage])},a.next=function(){a.currentPage<a.totalPage&&(a.currentPage++,a.setPage(a.currentPage,a.pageSize))},a.prev=function(){a.currentPage>1&&(a.currentPage--,a.setPage(a.currentPage,a.pageSize))},a.loadPage=function(b){a.currentPage=b,a.setPage(a.currentPage,a.pageSize)}}]),MetronicApp.controller("AnalyseController",["$scope","$http",function(a,b){}]),MetronicApp.controller("CompanySettingController",function(a,b,c,d,e,f){a.loginName=c.authentication.userName,b.get("http://"+e+"/Api/api/v1/Enterprise/GeneralTitle").success(function(b){a.GeneralTitle=b.Data}),b.get("http://"+e+"/Api/api/v1/Enterprise/GeneralRole").success(function(b){a.GeneralRole=b.Data}),b.get("http://"+e+"/Api/api/v1/Enterprise/GeneralDepartment").success(function(b){a.GeneralDepartment=b.Data}),b.get("http://"+e+"/Api/api/v1/UserProfile").success(function(d){a.userInfo=d.Data,"null"==a.userInfo.ContactInfo&&(c.logOut(),f.url("/Login/login/html")),a.parentId=a.userInfo.ParentId,b.get("http://"+e+"/Api/api/v1/Enterprise/"+a.parentId).success(function(b){a.company=b.Data,a.defaultCompanyName=a.company.Name,a.companyAbbr=a.company.Abbr,a.contactList=a.company.Contacts;for(var c=0;c<a.contactList.length;c++){a.contactList[c].defaultSet=!1,a.contactList[c].Name==a.company.ContactName&&(a.contactList[c].defaultSet=!0);for(var d=0;d<a.GeneralDepartment.length;d++)a.contactList[c].Department==a.GeneralDepartment[d].Id&&(a.contactList[c].Department=a.GeneralDepartment[d].Description);for(var e=0;e<a.GeneralRole.length;e++)a.contactList[c].Role==a.GeneralRole[e].Id&&(a.contactList[c].Role=a.GeneralRole[e].Description)}}),a.ContactInfo=JSON.parse(a.userInfo.ContactInfo),a.defaultName=a.ContactInfo.Name,a.defaultTel=a.ContactInfo.Tel1,a.contactId=a.ContactInfo.Id,a.MainAddressInfo=JSON.parse(a.userInfo.MainAddressInfo),""!=a.MainAddressInfo&&(a.addressId=a.MainAddressInfo[0].Id,a.defaultAddress=a.MainAddressInfo[0].AddressLine2),a.Identity=a.userInfo.Identity}).error(function(){c.logOut(),f.url("/Login/login/html")}),a.companySave=function(){var c={Id:a.parentId,ContactId:a.contactId,AddressId:a.addressId,Name:a.defaultCompanyName,Abbr:a.companyAbbr};b.put("http://"+e+"/Api/api/v1/Enterprise/"+a.Identity+"/EnterpriseInfo",c).success(function(){alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})};var g=function(b){for(var c=0;c<b.length;c++)b[c].defaultSet&&(a.defaultName=b[c].Name,a.defaultTel=b[c].Tel1)};b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/ProJson.json").success(function(b){a.getProvince=b}),b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/CityJson.json").success(function(b){a.City=b}),b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/DistrictJson.json").success(function(b){a.Street=b}),a.selProvince=[],a.getCity=[],a.getProData=function(b){if(a.getCity=[],a.selCity=[],a.selStreet=[],null!=b){a.selectProvince=b.ProName;for(var c=0;c<a.City.length;c++)a.selProvince.ProID==a.City[c].ProID&&a.getCity.push(a.City[c])}},a.getStreet=[],a.getCityData=function(b){if(a.getStreet=[],a.selStreet=0,null!=b){a.selectCity=b.CityName;for(var c=0;c<a.Street.length;c++)a.selCity.CityID==a.Street[c].CityID&&a.getStreet.push(a.Street[c])}},a.getStreetData=function(b){null!=b&&(a.selectStreet=b.DisName)},a.defaultCheck=!1,a.setDefault=function(){1==a.defaultCheck?a.defaultCheck=!1:a.defaultCheck=!0},a.saveInfo=function(){null==a.listId&&(a.listId=0);var c={Contact:{Id:a.listId,Name:a.acceptName,Email1:a.email,Department:a.department.Id,Title:a.title.Id,Role:a.role.Id,Tel1:a.telNumber,Tel2:a.phoneNum},UserIdentity:a.Identity,EnterpriseId:a.parentId,IsDefaultContact:a.defaultCheck},d={Department:a.department.Description,Title:a.title.Description,Role:a.role.Description,Name:a.acceptName,Email1:a.email,Tel1:a.telNumber,Tel2:a.phoneNum,defaultSet:a.defaultCheck};if(c.IsDefaultContact)for(var f=0;f<a.contactList.length;f++)a.contactList[f].defaultSet=!1;b.put("http://"+e+"/Api/api/v1/Enterprise/Contact",c).success(function(){0==c.Contact.Id?(a.contactList.push(d),g(a.contactList)):a.contactList.splice(a.list,1,d),alertInfo.Success("保存成功!"),h()}).error(function(){alertInfo.Error("保存失败!")})};var h=function(){a.acceptName="",a.phoneNum="",a.telNumber="",a.email="",a.department="",a.title="",a.role="",a.defaultCheck=!1};a.updateInfo=function(b){a.listId=a.contactList[b].Id,a.list=b,a.acceptName=a.contactList[b].Name,a.phoneNum=a.contactList[b].Tel2,a.telNumber=a.contactList[b].Tel1,a.email=a.contactList[b].Email1,a.defaultCheck=a.contactList[b].defaultSet},a.viewModal=function(b){a.delIndex=b},a.deleteInfo=function(){a.contactList.splice(a.delIndex,1),g(a.contactList)},a.showDefault=function(b){if(0==a.contactList[b].defaultSet){for(var c=0;c<a.contactList.length;c++)a.contactList[c].showSet=!1;a.contactList[b].showSet=!0}},a.hideDefault=function(){for(var b=0;b<a.contactList.length;b++)a.contactList[b].showSet=!1},a.changeAddress=function(c){for(var d=0;d<a.contactList.length;d++)a.contactList[d].showSet=!1,a.contactList[d].defaultSet=!1;b.put("http://"+e+"/Api/api/v1/Enterprise/"+a.parentId+"/DefaultContact/"+a.contactList[c].Id).success(function(){a.contactList[c].defaultSet=!0,g(a.contactList),alertInfo.Success("设置成功!")}).error(function(){alertInfo.Error("设置失败!")})}}),MetronicApp.controller("DashboardController",["$rootScope","$scope","$http","$timeout",function(a,b,c,d){b.$on("$viewContentLoaded",function(){Metronic.initAjax()})}]),MetronicApp.controller("DeliveryFinishController",["$scope","ModelService","$http","apiUrl","$filter",function(a,b,c,d,e){b.getCategory().success(function(b){a.category=b.Data,a.catelog=[];for(var c=0;c<a.category.length;c++)if(0===a.category[c].ParentCode){a.category[c].module=[];for(var d=0;d<a.category.length;d++)a.category[d].ParentCode===a.category[c].Id&&a.category[c].module.push(a.category[d]);a.catelog.push(a.category[c])}}).error(function(){}),a.isShowList=!0,a.ShowList=function(){a.isShowList=!a.isShowList},a.isShow=!0,a.packUpDown=function(){a.isShow=!a.isShow};var f=new Date;a.DocDateFrom=e("dateFilter")(f),a.DocDateTo=e("dateToFilter")(f),c.get("http://"+d+"/Api/api/DeliveryOrder?state=2").success(function(b){a.items1=b.Data;for(var c=0;c<a.items1.length;c++)a.items1[c].Actions="确认收货"}).error(function(){}),c.get("http://"+d+"/Api/api/DeliveryOrder?state=2").success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].orderCheck="确认收货";a.sellName=a.items;for(var d=0;d<a.sellName.length-1;d++)for(var e=d+1;e<a.sellName.length;e++)a.sellName[d].CarrierContactName===a.sellName[e].CarrierContactName&&(a.sellName.splice(e,1),e--)}).error(function(){}),a.orderCheckIn=function(b){a.items[b].orderCheck="确认成功";for(var e=a.items[b].CarrierAccountId,f=[],g=0;g<a.items1.length;g++)a.items1[g].CarrierAccountId===e&&(a.items1[g].DeliveryOrderLineState="3",a.items1[g].Actions="确认成功",f.push(a.items1[g].Id));c.put("http://"+d+"/Api/api/DeliveryOrderLine?state=3",f).success(function(){alert("运单完成！")}).error(function(){alert("卸货失败")})}}]),MetronicApp.controller("DeliverySearchController",["$http","$scope","apiUrl","ModelService","$filter",function(a,b,c,d,e){d.getCategory().success(function(a){b.category=a.Data,b.catelog=[];for(var c=0;c<b.category.length;c++)if(0===b.category[c].ParentCode){b.category[c].module=[];for(var d=0;d<b.category.length;d++)b.category[d].ParentCode==b.category[c].Id&&b.category[c].module.push(b.category[d]);b.catelog.push(b.category[c])}}).error(function(){}),b.isShowList=!0,b.ShowList=function(){b.isShowList=!b.isShowList},b.isShow=!0,b.packUpDown=function(){b.isShow=!b.isShow};var f=new Date;b.DocDateFrom=e("dateFilter")(f),b.DocDateTo=e("dateToFilter")(f),b.searchList=function(d){var e="http://"+c+"/Api/api/DeliveryOrder?state="+d;if(null!=b.DocDateFrom){var f=b.DocDateFrom.split("-").join("");e=e+"&dateFrom="+f}else e+="&dateFrom";if(null!=b.DocDateTo){var g=b.DocDateTo.split("-").join("");e=e+"&dateTo="+g}else e+="&dateTo";if(null!=b.ProductCode){var h=b.ProductCode;e=e+"&productCode="+h}else e+="&productCode";if(null!=b.DeliveryOrderNo){var i=b.DeliveryOrderNo;e=e+"&DeliveryOrderNo="+i}else e+="&DeliveryOrderNo";a.get(e).success(function(a){b.items1=a.Data;for(var c=0;c<b.items1.length;c++)b.items1[c].Actions="产品卸货";b.listCount=b.items1.slice(0,b.pageSize)}).error(function(){b.items1=[],b.listCount=[]})},b.checkListItem=[],b.checkItems=function(d){b.checkListItem.push(d);for(var e=0;e<b.checkListItem.length-1;e++)b.checkListItem[e].CatalogName==d.CatalogName&&(b.checkListItem.splice(e,1),b.checkListItem.splice(b.checkListItem.length-1,1));for(var f=[],g=0;g<b.checkListItem.length;g++)f.push(b.checkListItem[g].CatalogId);var h={CatalogIds:f};a.post("http://"+c+"/Api/api/SalesOrder?state=0",h).success(function(a){b.items1=a.Data;for(var c=0;c<b.items1.length;c++)b.items1[c].Actions="产品卸货";b.listCount=b.items1.slice(0,b.pageSize)})},a.get("http://"+c+"/Api/api/DeliveryOrder?state=1").success(function(a){b.items1=a.Data;for(var c=0;c<b.items1.length;c++)b.items1[c].Actions="产品卸货"}).error(function(){}),a.get("http://"+c+"/Api/api/DeliveryOrder?state=1").success(function(a){b.items=a.Data;for(var c=0;c<b.items.length;c++)b.items[c].orderCheck="运单卸货";b.sellName=b.items;for(var d=0;d<b.sellName.length-1;d++)for(var e=d+1;e<b.sellName.length;e++)b.sellName[d].CarrierContactName==b.sellName[e].CarrierContactName&&(b.sellName.splice(e,1),e--)}).error(function(){})}]),MetronicApp.controller("GeneralPageController",["$rootScope","$scope",function(a,b){b.$on("$viewContentLoaded",function(){Metronic.initAjax()})}]),MetronicApp.controller("indexController",["$scope","$location","$window","authService",function(a,b,c,d){a.authentication=d.authentication,0==a.authentication.isAuth&&(d.logOut(),a.authentication.isAuth=!1,b.url("/Login/login.html"))}]),MetronicApp.controller("LightTableController",["$scope","$http","ModelService","apiUrl","$filter","authService","$location",function(a,b,c,d,e,f,g){function h(a,b){for(var c=0;c<a.length-1;c++)a[c]==b.Id&&(a.splice(c,1),a.splice(a.length-1,1))}function i(c,e){var f={SalesId:a.salesId,SalesOrderId:0,Id:0,DateFrom:0,DateTo:0,ProductCode:0,CategoryId:c,StoreId:e,DeliveryPoint:[0]};b.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/GetPreparingLines",f,{cache:!0}).success(function(b){a.getSalesOrder=b.Data,console.log(a.getSalesOrder);for(var c=0;c<a.getSalesOrder.length;c++)a.getSalesOrder[c].Actions="安排备货";a.totalPage=Math.ceil(a.getSalesOrder.length/a.pageSize),a.listCount=a.getSalesOrder.slice(0,a.pageSize)})}0==f.authentication.isAuth&&(f.logOut(),g.url("/Login/login.html")),b.get("http://"+d+"/Api/api/v1/Sales/Profile").success(function(b){a.SalesInfo=b.Data,a.salesId=a.SalesInfo.SalesId,a.StoreInfo=JSON.parse(a.SalesInfo.storeInfos),i([0],[0])}),c.getCategory().success(function(b){a.category=b.Data,a.catelog=[];for(var c=0;c<a.category.length;c++)if(0==a.category[c].ParentCode){a.category[c].module=[];for(var d=0;d<a.category.length;d++)a.category[d].ParentCode==a.category[c].Id&&a.category[c].module.push(a.category[d]);a.catelog.push(a.category[c])}}),a.isShowList=!0,a.ShowList=function(){a.isShowList=!a.isShowList},a.isShow=!0,a.packUpDown=function(){a.isShow=!a.isShow};var j=new Date;a.DocDateFrom=e("dateFilter")(j),a.DocDateTo=e("dateToFilter")(j),a.searchList=function(c){var e={state:c,DateFrom:f,DateTo:g,ProductCode:h,BuyerAccountName:i};if(null!=a.DocDateFrom)var f=a.DocDateFrom.split("-").join("");else f="";if(null!=a.DocDateTo)var g=a.DocDateTo.split("-").join("");else g="";if(null!=a.ProductCode)var h=a.ProductCode;else h="";if(null!=a.BuyerAccountName)var i=a.BuyerAccountName;else i="";var j={method:"POST",url:"http://"+d+"/Api/api/SalesOrder?one",data:e};b(j).success(function(b){a.items=b.data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1,a.items[c].Actions="安排备货";a.listCount=a.items.slice(0,a.pageSize)}).error(function(){a.items=[],a.listCount=[]})},a.checkListItem=[],a.checkItems=function(b){a.checkListItem.push(b.Id),h(a.checkListItem,b),i(a.checkListItem,[0])},a.checkStoreItem=[],a.checkStore=function(b){a.checkStoreItem.push(b.StoreId),h(a.checkStoreItem,b),i([0],a.checkStoreItem)},a.allList=function(){i([0],[0])},a.checkBox=!1,a.List=[],a.CheckElement=function(b,c){if(0==c)for(var d=0;d<a.List.length;d++)a.listCount[b].Id==a.List[d].Id&&a.List.splice(d,1);else a.List.push(a.listCount[b])},a.master=!1,a.checkAll=function(b){if(0==b){a.checkBox=!0;for(var c=0;c<a.listCount.length;c++)a.List.push(a.listCount[c])}else a.checkBox=!1,a.List=[],console.log(a.List)},a.stuckConfirm=function(){var c=[],e=[];if(a.List.length>0){for(var f=0;f<a.List.length;f++)e.push(a.List[f].DocCode);for(var g=Enumerable.From(e).Distinct().ToArray(),h=0;h<g.length;h++){for(var i=[],j=[],k=0;k<a.List.length;k++)g[h]==a.List[k].DocCode&&(j.push(a.List[k].Id),i={DocCode:g[h],SalesOrderLineIds:j});c.push(i)}b.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/"+a.salesId+"/Preparing",c).success(function(){alertInfo.Success("已安排仓库备货!");for(var b=0;b<a.List.length;b++)a.List[b].Status="10",a.List[b].Actions="取消安排"}).error(function(){alertInfo.Error("安排仓库备货失败!")})}},a.test=function(b){a.list=a.listCount[b],console.log(a.list)},a.Confirm=function(){"安排备货"==a.list.Actions?b.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/"+a.salesId+"/Preparing",[{DocCode:a.list.DocCode,SalesOrderLineIds:[a.list.Id]}]).success(function(){alertInfo.Success("已安排仓库备货!"),a.list.Status="10",a.list.Actions="取消安排"}).error(function(){alertInfo.Error("安排备货失败!")}):"取消安排"==a.list.Actions&&b.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/"+a.salesId+"/CancelPrepared",[{DocCode:a.list.DocCode,SalesOrderLineIds:[a.list.Id]}]).success(function(){alertInfo.Success("已安排仓库备货!"),a.list.Status="4",a.list.Actions="安排备货"}).error(function(){alertInfo.Error("取消备货失败!")})},a.currentPage=1,a.pages=[1,2,3,4,5],a.pageSize=10,a.setPage=function(b,c){a.listCount=a.items.slice((b-1)*c,b*c),a.currentPage<=5&&(a.pages=[1,2,3,4,5]),a.currentPage>5&&(a.pages=[a.currentPage-4,a.currentPage-3,a.currentPage-2,a.currentPage-1,a.currentPage])},a.next=function(){a.currentPage<a.totalPage&&(a.currentPage++,a.setPage(a.currentPage,a.pageSize))},a.prev=function(){a.currentPage>1&&(a.currentPage--,a.setPage(a.currentPage,a.pageSize))},a.loadPage=function(b){a.currentPage=b,a.setPage(a.currentPage,a.pageSize)}}]),MetronicApp.controller("LoginController",["$scope","$location","$rootScope","authService","$http","apiUrl","localStorageService",function(a,b,c,d,e,f,g){d.authentication.isAuth?b.url("/sales/productList/all"):d.logOut(),a.loginData={userName:"",password:""},a.message="",a.login=function(){d.login(a.loginData).then(function(c){e.get("http://"+f+"/Api/api/v1/UserProfile").success(function(d){a.userProfile=d.Data,console.log(d.Data),null==g.get(c.userName+"image")&&g.set(c.userName+"image","/assets/admin/pages/media/profile/profile_user.jpg"),b.path("/sales/productList/all").replace(),top.location.reload()}).error(function(){d.logOut(),alertInfo.Error("登录失败!")})},function(b){a.message=b.error_description})}}]),MetronicApp.controller("OrderFinishController",["$scope","$http","ModelService","apiUrl","$filter",function(a,b,c,d,e){c.getData(28).success(function(b){if(null===b.ErrMessage){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1,a.items[c].Actions="通知备货";a.len=a.items.length,a.len>0&&(a.totalPage=Math.ceil(a.len/a.pageSize),a.listCount=a.items.slice(0,a.pageSize))}}),c.getCategory().success(function(b){a.category=b.Data,a.catelog=[];for(var c=0;c<a.category.length;c++)if(0==a.category[c].ParentCode){a.category[c].module=[];for(var d=0;d<a.category.length;d++)a.category[d].ParentCode==a.category[c].Id&&a.category[c].module.push(a.category[d]);a.catelog.push(a.category[c])}}).error(function(){}),a.isShowList=!0,a.ShowList=function(){a.isShowList=!a.isShowList},a.isShow=!0,a.packUpDown=function(){a.isShow=!a.isShow};var f=new Date;a.DocDateFrom=e("dateFilter")(f),a.DocDateTo=e("dateToFilter")(f),a.searchList=function(c){var e="http://"+d+"/Api/api/SalesOrder?state="+c;if(null!==a.DocDateFrom){var f=a.DocDateFrom.split("-").join("");e=e+"&dateFrom="+f}else e+="&dateFrom";if(null!==a.DocDateTo){var g=a.DocDateTo.split("-").join("");e=e+"&dateTo="+g}else e+="&dateTo";if(null!==a.ProductCode){var h=a.ProductCode;e=e+"&productCode="+h}else e+="&productCode";if(null!==a.BuyerAccountName){var i=a.BuyerAccountName;e=e+"&buyerAccountName="+i}else e+="&buyerAccountName";b.get(e).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1,a.items[c].Actions="通知备货";a.listCount=a.items.slice(0,a.pageSize)}).error(function(){a.items=[],a.listCount=[]})},a.checkListItem=[],a.checkItems=function(c){a.checkListItem.push(c);for(var e=0;e<a.checkListItem.length-1;e++)a.checkListItem[e].CatalogName==c.CatalogName&&(a.checkListItem.splice(e,1),a.checkListItem.splice(a.checkListItem.length-1,1));for(var f=[],g=0;g<a.checkListItem.length;g++)f.push(a.checkListItem[g].CatalogId);var h=f.join("*");b.get("http://"+d+"/Api/api/SalesOrder?state=28&catalog="+h).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1;a.listCount=a.items.slice(0,a.pageSize)})},a.allList=function(){c.getData(28).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1,a.items[c].Actions="通知备货";a.len=a.items.length,a.len>0&&(a.totalPage=Math.ceil(a.len/a.pageSize),a.listCount=a.items.slice(0,a.pageSize))})},a.stuckConfirm=function(){if(a.testItem=[],a.List.length>0){for(var c=0;c<a.List.length;c++)a.List[c].isCheck=!1,a.List[c].SalesOrderLineState="10",a.List[c].Actions="取消通知",a.testItem.push(a.List[c].SalesOrderLineId);b.put("http://"+d+"/Api/api/SalesOrderLine?state=1",a.testItem).success(function(){alert("ok")})}},a.test=function(b){a.list=a.listCount[b]},a.Confirm=function(){a.listId=[],a.listId.push(a.list.SalesOrderLineId),"通知备货"==a.list.Actions?(a.list.SalesOrderLineState="10",a.list.Actions="取消通知",b.put("http://"+d+"/Api/api/SalesOrderLine?state=1",a.listId).success(function(){alert("ok")}).error(function(){alert("error")})):"取消通知"==a.list.Actions&&(a.list.SalesOrderLineState="0",a.list.Actions="通知备货",b.put("http://"+d+"/Api/api/SalesOrderLine?state=0",a.listId).success(function(){alert("ok")}).error(function(){alert("error")}))},a.List=[],a.CheckElement=function(b){if(0==a.listCount[b].isCheck)a.List.splice(0,0,a.listCount[b]),a.listCount[b].isCheck=!0;else if(1==a.listCount[b].isCheck)for(var c=0;c<a.List.length;c++)a.listCount[b].ProductId==a.List[c].ProductId&&(a.listCount[b].isCheck=!1,a.List.splice(c,1));console.log(a.List)},a.checkAll=function(){for(var b=0;b<a.listCount.length;b++)0==a.listCount[b].isCheck?(a.List.splice(0,0,a.listCount[b]),a.listCount[b].isCheck=!0):1==a.listCount[b].isCheck&&(a.listCount[b].isCheck=!1,a.List=[])},a.currentPage=1,a.pages=[1,2,3,4,5],a.pageSize=10,a.setPage=function(b,c){a.listCount=a.items.slice((b-1)*c,b*c),a.currentPage<=5&&(a.pages=[1,2,3,4,5]),a.currentPage>5&&(a.pages=[a.currentPage-4,a.currentPage-3,a.currentPage-2,a.currentPage-1,a.currentPage])},a.next=function(){a.currentPage<a.totalPage&&(a.currentPage++,a.setPage(a.currentPage,a.pageSize))},a.prev=function(){a.currentPage>1&&(a.currentPage--,a.setPage(a.currentPage,a.pageSize))},a.loadPage=function(b){a.currentPage=b,a.setPage(a.currentPage,a.pageSize)}}]),MetronicApp.controller("OrderLoadingController",["$http","$scope","ModelService","apiUrl","$filter",function(a,b,c,d,e){function f(a,b){for(var c=0;c<a.length-1;c++)a[c]==b.Id&&(a.splice(c,1),a.splice(a.length-1,1))}function g(c,e){var f={SalesId:b.salesId,SalesOrderId:0,Id:0,DateFrom:0,DateTo:0,ProductCode:0,
CategoryId:c,StoreId:e,DeliveryPoint:[0]};a.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/GetStuffingLines",f,{cache:!0}).success(function(a){b.getSalesOrder=a.Data,console.log(a.Data);for(var c=0;c<b.getSalesOrder.length;c++)b.getSalesOrder[c].Actions="安排装柜";b.totalPage=Math.ceil(b.getSalesOrder.length/b.pageSize),b.listCount=b.getSalesOrder.slice(0,b.pageSize)})}a.get("http://"+d+"/Api/api/v1/Sales/Profile").success(function(a){b.SalesInfo=a.Data,b.salesId=b.SalesInfo.SalesId,b.StoreInfo=JSON.parse(b.SalesInfo.storeInfos),g([0],[0])}),c.getCategory().success(function(a){b.category=a.Data,b.catelog=[];for(var c=0;c<b.category.length;c++)if(0==b.category[c].ParentCode){b.category[c].module=[];for(var d=0;d<b.category.length;d++)b.category[d].ParentCode==b.category[c].Id&&b.category[c].module.push(b.category[d]);b.catelog.push(b.category[c])}}).error(function(){}),b.isShowList=!0,b.ShowList=function(){b.isShowList=!b.isShowList},b.isShow=!0,b.packUpDown=function(){b.isShow=!b.isShow};var h=new Date;b.DocDateFrom=e("dateFilter")(h),b.DocDateTo=e("dateToFilter")(h),b.searchList=function(c){var e="http://"+d+"/Api/api/SalesOrder?state="+c;if(null!=b.DocDateFrom){var f=b.DocDateFrom.split("-").join("");e=e+"&dateFrom="+f}else e+="&dateFrom";if(null!=b.DocDateTo){var g=b.DocDateTo.split("-").join("");e=e+"&dateTo="+g}else e+="&dateTo";if(null!=b.ProductCode){var h=b.ProductCode;e=e+"&productCode="+h}else e+="&productCode";if(null!=b.BuyerAccountName){var i=b.BuyerAccountName;e=e+"&buyerAccountName="+i}else e+="&buyerAccountName";a.get(e).success(function(a){b.items=a.Data;for(var c=0;c<b.items.length;c++)b.items[c].isCheck=!1,b.items[c].Actions="安排装柜";b.listCount=b.items.slice(0,b.pageSize)}).error(function(){b.items=[],b.listCount=[]})},b.checkListItem=[],b.checkItems=function(a){b.checkListItem.push(a.Id),f(b.checkListItem,a),g(b.checkListItem,[0])},b.checkStoreItem=[],b.checkStore=function(a){b.checkStoreItem.push(a.StoreId),f(b.checkStoreItem,a),g([0],checkStoreItem)},b.allList=function(){g(b.salesId,[0],[0])},b.checkBox=!1,b.List=[],b.CheckElement=function(a,c){if(0==c)for(var d=0;d<b.List.length;d++)b.listCount[a].Id==b.List[d].Id&&b.List.splice(d,1);else b.List.push(b.listCount[a])},b.master=!1,b.checkAll=function(a){if(0==a){b.checkBox=!0;for(var c=0;c<b.listCount.length;c++)b.List.push(b.listCount[c])}else b.checkBox=!1,b.List=[],console.log(b.List)},a.get("http://"+d+"/Api/api/v1/Sales/SalesOrders/Carrier").success(function(a){b.shipCompany=a.Data}),b.getCompanyId=function(c,e){b.shipCompanyId=c,a.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/"+b.salesId+"/UpdateCarrier",{SalesOrderLineId:e.Id,CarrierAccountId:c}).success(function(){for(var a=0;a<b.shipCompany.length;a++)b.shipCompany[a].Id==c&&(e.shipCompanyName=b.shipCompany[a].Name,e.companyId=c)}).error(function(){alertInfo.Error("失败")})},b.shippingConfirm=function(){b.List.length>0&&(angular.isDefined(b.shipCompanyId)?b.isShowTestModal=!0:(b.isShowTestModal=!1,alertInfo.Error("请先选择货运公司!")))},b.stuckConfirm=function(){var c=[],e=[];if(b.List.length>0){for(var f=0;f<b.List.length;f++)e.push(b.List[f].DocCode);for(var g=Enumerable.From(e).Distinct().ToArray(),h=0;h<g.length;h++){for(var i=[],j=[],k=0;k<b.List.length;k++)g[h]==b.List[k].DocCode&&(j.push(b.List[k].Id),i={DocCode:g[h],SalesOrderLineIds:j});c.push(i)}a.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/"+b.salesId+"/Stuffing",c).success(function(){for(var a=0;a<b.List.length;a++)b.List[a].Status="12",b.List[a].Actions="取消安排";alertInfo.Success("安排装柜成功!")}).error(function(){alertInfo.Error("安排装柜失败!")})}},b.viewModel=function(a){b.isShowModal=!0,angular.isDefined(b.shipCompanyId)?b.list=b.listCount[a]:(b.isShowModal=!1,alertInfo.Error("请先选择货运公司!"))},b.Confirm=function(){"安排装柜"==b.list.Actions?a.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/"+b.salesId+"/Stuffing",[{DocCode:b.list.DocCode,SalesOrderLineIds:[b.list.Id]}]).success(function(){b.list.Status="12",b.list.Actions="取消安排",alertInfo.Success("安排装柜成功!")}).error(function(){alertInfo.Error("装柜失败!")}):"取消安排"==b.list.Actions&&a.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/"+b.salesId+"/CancelStuffed",[{DocCode:b.list.DocCode,SalesOrderLineIds:[b.list.Id]}]).success(function(){b.list.Status="32",b.list.Actions="安排装柜",alertInfo.Success("取消安排装柜!")}).error(function(){alertInfo.Error("取消失败!")})},b.currentPage=1,b.pages=[1,2,3,4,5],b.pageSize=10,b.setPage=function(a,c){b.listCount=b.items.slice((a-1)*c,a*c),b.currentPage<=5&&(b.pages=[1,2,3,4,5]),b.currentPage>5&&(b.pages=[b.currentPage-4,b.currentPage-3,b.currentPage-2,b.currentPage-1,b.currentPage])},b.next=function(){b.currentPage<b.totalPage&&(b.currentPage++,b.setPage(b.currentPage,b.pageSize))},b.prev=function(){b.currentPage>1&&(b.currentPage--,b.setPage(b.currentPage,b.pageSize))},b.loadPage=function(a){b.currentPage=a,b.setPage(b.currentPage,b.pageSize)}}]),MetronicApp.controller("OrderPrepareController",["$scope","$http","ModelService","apiUrl","$filter",function(a,b,c,d,e){function f(a,b){for(var c=0;c<a.length-1;c++)a[c]==b.Id&&(a.splice(c,1),a.splice(a.length-1,1))}function g(c,e){var f={SalesId:a.salesId,SalesOrderId:0,Id:0,DateFrom:0,DateTo:0,ProductCode:0,CategoryId:c,StoreId:e,DeliveryPoint:[0]};b.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/GetStorePreparingLines",f,{cache:!0}).success(function(b){a.getSalesOrder=b.Data;for(var c=0;c<a.getSalesOrder.length;c++)a.getSalesOrder[c].Actions="备货完成";a.totalPage=Math.ceil(a.getSalesOrder.length/a.pageSize),a.listCount=a.getSalesOrder.slice(0,a.pageSize)})}b.get("http://"+d+"/Api/api/v1/Sales/Profile").success(function(b){a.SalesInfo=b.Data,a.salesId=a.SalesInfo.SalesId,a.StoreInfo=JSON.parse(a.SalesInfo.storeInfos),g([0],[0])}),c.getCategory().success(function(b){a.category=b.Data,a.catelog=[];for(var c=0;c<a.category.length;c++)if(0==a.category[c].ParentCode){a.category[c].module=[];for(var d=0;d<a.category.length;d++)a.category[d].ParentCode==a.category[c].Id&&a.category[c].module.push(a.category[d]);a.catelog.push(a.category[c])}}).error(function(){}),a.isShowList=!0,a.ShowList=function(){a.isShowList=!a.isShowList},a.isShow=!0,a.packUpDown=function(){a.isShow=!a.isShow};var h=new Date;a.DocDateFrom=e("dateFilter")(h),a.DocDateTo=e("dateToFilter")(h),a.searchList=function(c){var e="http://"+d+"/Api/api/SalesOrder?state="+c;if(null!=a.DocDateFrom){var f=a.DocDateFrom.split("-").join("");e=e+"&dateFrom="+f}else e+="&dateFrom";if(null!=a.DocDateTo){var g=a.DocDateTo.split("-").join("");e=e+"&dateTo="+g}else e+="&dateTo";if(null!=a.ProductCode){var h=a.ProductCode;e=e+"&productCode="+h}else e+="&productCode";if(null!=a.BuyerAccountName){var i=a.BuyerAccountName;e=e+"&buyerAccountName="+i}else e+="&buyerAccountName";b.get(e).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1,a.items[c].Actions="备货完成";a.listCount=a.items.slice(0,a.pageSize)}).error(function(){a.items=[],a.listCount=[]})},a.checkListItem=[],a.checkItems=function(b){a.checkListItem.push(b.Id),f(a.checkListItem,b),g(a.checkListItem,[0])},a.checkStoreItem=[],a.checkStore=function(b){a.checkStoreItem.push(b.StoreId),f(a.checkStoreItem,b),g([0],checkStoreItem)},a.allList=function(){g(a.salesId,[0],[0])},a.checkBox=!1,a.List=[],a.CheckElement=function(b,c){if(0==c)for(var d=0;d<a.List.length;d++)a.listCount[b].Id==a.List[d].Id&&a.List.splice(d,1);else a.List.push(a.listCount[b])},a.master=!1,a.checkAll=function(b){if(0==b){a.checkBox=!0;for(var c=0;c<a.listCount.length;c++)a.List.push(a.listCount[c])}else a.checkBox=!1,a.List=[],console.log(a.List)},a.stuckConfirm=function(){var c=[],e=[];if(a.List.length>0){for(var f=0;f<a.List.length;f++)e.push(a.List[f].DocCode);for(var g=Enumerable.From(e).Distinct().ToArray(),h=0;h<g.length;h++){for(var i=[],j=[],k=0;k<a.List.length;k++)g[h]==a.List[k].DocCode&&(j.push(a.List[k].Id),i={DocCode:g[h],SalesOrderLineIds:j});c.push(i)}b.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/"+a.salesId+"/StorePreparing",c).success(function(){alertInfo.Success("仓库备货完成!");for(var b=0;b<a.List.length;b++)a.List[b].Actions="取消备货",a.List[b].Status="11"}).error(function(){alertInfo.Error("仓库备货失败!")})}},a.test=function(b){a.list=a.listCount[b]},a.Confirm=function(){"备货完成"==a.list.Actions?b.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/"+a.salesId+"/StorePreparing",[{DocCode:a.list.DocCode,SalesOrderLineIds:[a.list.Id]}]).success(function(){alertInfo.Success("仓库备货完成!"),a.list.Status="11",a.list.Actions="取消备货"}).error(function(){alertInfo.Error("仓库备货失败!")}):"取消备货"==a.list.Actions&&b.put("http://"+d+"/Api/api/v1/Sales/SalesOrders/"+a.salesId+"/CancelStorePrepared",[{DocCode:a.list.DocCode,SalesOrderLineIds:[a.list.Id]}]).success(function(){alertInfo.Success("取消仓库备货!"),a.list.Status="16",a.list.Actions="备货完成"}).error(function(){alertInfo.Error("取消仓库备货失败!")})},a.currentPage=1,a.pages=[1,2,3,4,5],a.pageSize=10,a.setPage=function(b,c){a.listCount=a.items.slice((b-1)*c,b*c),a.currentPage<=5&&(a.pages=[1,2,3,4,5]),a.currentPage>5&&(a.pages=[a.currentPage-4,a.currentPage-3,a.currentPage-2,a.currentPage-1,a.currentPage])},a.next=function(){a.currentPage<a.totalPage&&(a.currentPage++,a.setPage(a.currentPage,a.pageSize))},a.prev=function(){a.currentPage>1&&(a.currentPage--,a.setPage(a.currentPage,a.pageSize))},a.loadPage=function(b){a.currentPage=b,a.setPage(a.currentPage,a.pageSize)}}]),MetronicApp.controller("OrderReceivingController",["$scope","$http","ModelService","apiUrl","$filter",function(a,b,c,d,e){c.getData(27).success(function(b){if(null===b.ErrMessage){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1,a.items[c].Actions="待收货";a.len=a.items.length,a.len>0&&(a.totalPage=Math.ceil(a.len/a.pageSize),a.listCount=a.items.slice(0,a.pageSize))}}),c.getCategory().success(function(b){a.category=b.Data,a.catelog=[];for(var c=0;c<a.category.length;c++)if(0==a.category[c].ParentCode){a.category[c].module=[];for(var d=0;d<a.category.length;d++)a.category[d].ParentCode==a.category[c].Id&&a.category[c].module.push(a.category[d]);a.catelog.push(a.category[c])}}).error(function(){}),a.isShowList=!0,a.ShowList=function(){a.isShowList=!a.isShowList},a.isShow=!0,a.packUpDown=function(){a.isShow=!a.isShow};var f=new Date;a.DocDateFrom=e("dateFilter")(f),a.DocDateTo=e("dateToFilter")(f),a.searchList=function(c){var e="http://"+d+"/Api/api/SalesOrder?state="+c;if(null!==a.DocDateFrom){var f=a.DocDateFrom.split("-").join("");e=e+"&dateFrom="+f}else e+="&dateFrom";if(null!==a.DocDateTo){var g=a.DocDateTo.split("-").join("");e=e+"&dateTo="+g}else e+="&dateTo";if(null!==a.ProductCode){var h=a.ProductCode;e=e+"&productCode="+h}else e+="&productCode";if(null!==a.BuyerAccountName){var i=a.BuyerAccountName;e=e+"&buyerAccountName="+i}else e+="&buyerAccountName";b.get(e).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1,a.items[c].Actions="待收货";a.listCount=a.items.slice(0,a.pageSize)}).error(function(){a.items=[],a.listCount=[]})},a.checkListItem=[],a.checkItems=function(c){a.checkListItem.push(c);for(var e=0;e<a.checkListItem.length-1;e++)a.checkListItem[e].CatalogName==c.CatalogName&&(a.checkListItem.splice(e,1),a.checkListItem.splice(a.checkListItem.length-1,1));for(var f=[],g=0;g<a.checkListItem.length;g++)f.push(a.checkListItem[g].CatalogId);var h=f.join("*");b.get("http://"+d+"/Api/api/SalesOrder?state=27&catalog="+h).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1;a.listCount=a.items.slice(0,a.pageSize)})},a.allList=function(){c.getData(27).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1,a.items[c].Actions="待收货";a.len=a.items.length,a.len>0&&(a.totalPage=Math.ceil(a.len/a.pageSize),a.listCount=a.items.slice(0,a.pageSize))})},a.stuckConfirm=function(){if(a.testItem=[],a.List.length>0){for(var c=0;c<a.List.length;c++)a.List[c].isCheck=!1,a.List[c].SalesOrderLineState="14",a.List[c].Actions="取消收货",a.testItem.push(a.List[c].SalesOrderLineId);b.put("http://"+d+"/Api/api/SalesOrderLine?state=5",a.testItem).success(function(){alertInfo.Success("ok!")})}},a.test=function(b){a.list=a.listCount[b]},a.Confirm=function(){a.listId=[],a.listId.push(a.list.SalesOrderLineId),"待收货"==a.list.Actions?(a.list.SalesOrderLineState="14",a.list.Actions="取消收货",b.put("http://"+d+"/Api/api/SalesOrderLine?state=5",a.listId).success(function(){alert("ok")}).error(function(){alert("error")})):"取消收货"==a.list.Actions&&(a.list.SalesOrderLineState="4",a.list.Actions="待收货",b.put("http://"+d+"/Api/api/SalesOrderLine?state=4",a.listId).success(function(){alert("ok")}).error(function(){alert("error")}))},a.List=[],a.CheckElement=function(b){if(0==a.listCount[b].isCheck)a.List.splice(0,0,a.listCount[b]),a.listCount[b].isCheck=!0;else if(1==a.listCount[b].isCheck)for(var c=0;c<a.List.length;c++)a.listCount[b].ProductId==a.List[c].ProductId&&(a.listCount[b].isCheck=!1,a.List.splice(c,1))},a.checkAll=function(){for(var b=0;b<a.listCount.length;b++)0==a.listCount[b].isCheck?(a.List.splice(0,0,a.listCount[b]),a.listCount[b].isCheck=!0):1==a.listCount[b].isCheck&&(a.listCount[b].isCheck=!1,a.List=[])},a.currentPage=1,a.pages=[1,2,3,4,5],a.pageSize=10,a.setPage=function(b,c){a.listCount=a.items.slice((b-1)*c,b*c),a.currentPage<=5&&(a.pages=[1,2,3,4,5]),a.currentPage>5&&(a.pages=[a.currentPage-4,a.currentPage-3,a.currentPage-2,a.currentPage-1,a.currentPage])},a.next=function(){a.currentPage<a.totalPage&&(a.currentPage++,a.setPage(a.currentPage,a.pageSize))},a.prev=function(){a.currentPage>1&&(a.currentPage--,a.setPage(a.currentPage,a.pageSize))},a.loadPage=function(b){a.currentPage=b,a.setPage(a.currentPage,a.pageSize)}}]),MetronicApp.controller("OrderRegisterController",["$http","$scope","apiUrl","ModelService","$filter",function(a,b,c,d,e){d.getCategory().success(function(a){b.category=a.Data,b.catelog=[];for(var c=0;c<b.category.length;c++)if(0==b.category[c].ParentCode){b.category[c].module=[];for(var d=0;d<b.category.length;d++)b.category[d].ParentCode==b.category[c].Id&&b.category[c].module.push(b.category[d]);b.catelog.push(b.category[c])}}).error(function(){}),b.isShowList=!0,b.ShowList=function(){b.isShowList=!b.isShowList},b.isShow=!0,b.packUpDown=function(){b.isShow=!b.isShow};var f=new Date;b.DocDateFrom=e("dateFilter")(f),b.DocDateTo=e("dateToFilter")(f),a.get("http://"+c+"/Api/api/DeliveryOrder?state=0").success(function(a){b.items1=a.Data}).error(function(){}),a.get("http://"+c+"/Api/api/DeliveryOrder?state=0").success(function(a){b.items=a.Data;for(var c=0;c<b.items.length;c++)b.items[c].orderCheck="运单登记";b.sellName=b.items;for(var d=0;d<b.sellName.length-1;d++)for(var e=d+1;e<b.sellName.length;e++)b.sellName[d].CarrierContactName==b.sellName[e].CarrierContactName&&(b.sellName.splice(e,1),e--)}),b.orderCheckIn=function(d){b.items[d].orderCheck="登记成功";for(var e=b.items[d].CarrierAccountId,f=[],g=0;g<b.items1.length;g++)b.items1[g].CarrierAccountId==e&&(b.items1[g].DeliveryOrderLineState="15",f.push(b.items1[g].Id));a.put("http://"+c+"/Api/api/DeliveryOrderLine?state=1",f).success(function(){toastr.success("运单登记成功!","成功！",{closeButton:!0,debug:!1,positionClass:"toast-bottom-full-width",showDuration:"300",hideDuration:"1000",timeOut:"1500",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"})}).error(function(){})}}]),MetronicApp.controller("OrderShippingController",["$scope","$http","ModelService","apiUrl","$filter",function(a,b,c,d,e){c.getData(26).success(function(b){if(null===b.ErrMessage){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1,a.items[c].Actions="待运送";a.len=a.items.length,a.len>0&&(a.totalPage=Math.ceil(a.len/a.pageSize),a.listCount=a.items.slice(0,a.pageSize))}}),c.getCategory().success(function(b){a.category=b.Data,a.catelog=[];for(var c=0;c<a.category.length;c++)if(0==a.category[c].ParentCode){a.category[c].module=[];for(var d=0;d<a.category.length;d++)a.category[d].ParentCode==a.category[c].Id&&a.category[c].module.push(a.category[d]);a.catelog.push(a.category[c])}}).error(function(){}),c.getArea().success(function(b){null==b.ErrMessage&&(a.getStock=b.Data)}),a.isShowList=!0,a.ShowList=function(){a.isShowList=!a.isShowList},a.isShow=!0,a.packUpDown=function(){a.isShow=!a.isShow};var f=new Date;a.DocDateFrom=e("dateFilter")(f),a.DocDateTo=e("dateToFilter")(f),a.searchList=function(c){var e="http://"+d+"/Api/api/SalesOrder?state="+c;if(null!==a.DocDateFrom){var f=a.DocDateFrom.split("-").join("");e=e+"&dateFrom="+f}else e+="&dateFrom";if(null!==a.DocDateTo){var g=a.DocDateTo.split("-").join("");e=e+"&dateTo="+g}else e+="&dateTo";if(null!==a.ProductCode){var h=a.ProductCode;e=e+"&productCode="+h}else e+="&productCode";if(null!==a.BuyerAccountName){var i=a.BuyerAccountName;e=e+"&buyerAccountName="+i}else e+="&buyerAccountName";b.get(e).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1,a.items[c].Actions="待运送";a.listCount=a.items.slice(0,a.pageSize)}).error(function(){a.items=[],a.listCount=[]})},a.checkListItem=[],a.checkItems=function(c){a.checkListItem.push(c);for(var e=0;e<a.checkListItem.length-1;e++)a.checkListItem[e].CatalogName==c.CatalogName&&(a.checkListItem.splice(e,1),a.checkListItem.splice(a.checkListItem.length-1,1));for(var f=[],g=0;g<a.checkListItem.length;g++)f.push(a.checkListItem[g].CatalogId);var h=f.join("*");b.get("http://"+d+"/Api/api/SalesOrder?state=26&catalog="+h).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1;a.listCount=a.items.slice(0,a.pageSize)})},a.allList=function(){c.getData(26).success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].isCheck=!1;a.len=a.items.length,a.len>0&&(a.totalPage=Math.ceil(a.len/a.pageSize),a.listCount=a.items.slice(0,a.pageSize))})},a.stuckConfirm=function(){if(a.testItem=[],a.List.length>0)for(var b=0;b<a.List.length;b++)a.List[b].isCheck=!1,a.List[b].SalesOrderLineState="13",a.List[b].Actions="取消发运",a.testItem.push(a.List[b].SalesOrderLineId)},a.test=function(b){a.list=a.listCount[b]},a.Confirm=function(){a.listId=[],a.listId.push(a.list.SalesOrderLineId),"待运送"==a.list.Actions?(a.list.SalesOrderLineState="13",a.list.Actions="取消运送",b.put("http://"+d+"/Api/api/SalesOrderLine?state=5",a.listId).success(function(){alert("ok")}).error(function(){alert("error")})):"取消运送"==a.list.Actions&&(a.list.SalesOrderLineState="4",a.list.Actions="待运送",b.put("http://"+d+"/Api/api/SalesOrderLine?state=4",a.listId).success(function(){alert("ok")}).error(function(){alert("error")}))},a.List=[],a.CheckElement=function(b){if(0==a.listCount[b].isCheck)a.List.splice(0,0,a.listCount[b]),a.listCount[b].isCheck=!0;else if(1==a.listCount[b].isCheck)for(var c=0;c<a.List.length;c++)a.listCount[b].ProductId==a.List[c].ProductId&&(a.listCount[b].isCheck=!1,a.List.splice(c,1))},a.checkAll=function(){for(var b=0;b<a.listCount.length;b++)0==a.listCount[b].isCheck?(a.List.splice(0,0,a.listCount[b]),a.listCount[b].isCheck=!0):1==a.listCount[b].isCheck&&(a.listCount[b].isCheck=!1,a.List=[])},a.currentPage=1,a.pages=[1,2,3,4,5],a.pageSize=10,a.setPage=function(b,c){a.listCount=a.items.slice((b-1)*c,b*c),a.currentPage<=5&&(a.pages=[1,2,3,4,5]),a.currentPage>5&&(a.pages=[a.currentPage-4,a.currentPage-3,a.currentPage-2,a.currentPage-1,a.currentPage])},a.next=function(){a.currentPage<a.totalPage&&(a.currentPage++,a.setPage(a.currentPage,a.pageSize))},a.prev=function(){a.currentPage>1&&(a.currentPage--,a.setPage(a.currentPage,a.pageSize))},a.loadPage=function(b){a.currentPage=b,a.setPage(a.currentPage,a.pageSize)}}]),MetronicApp.controller("OrderUnLoadController",["$scope","ModelService","$http","apiUrl","$filter",function(a,b,c,d,e){b.getCategory().success(function(b){a.category=b.Data,a.catelog=[];for(var c=0;c<a.category.length;c++)if(0==a.category[c].ParentCode){a.category[c].module=[];for(var d=0;d<a.category.length;d++)a.category[d].ParentCode==a.category[c].Id&&a.category[c].module.push(a.category[d]);a.catelog.push(a.category[c])}}).error(function(){}),a.isShowList=!0,a.ShowList=function(){a.isShowList=!a.isShowList},a.isShow=!0,a.packUpDown=function(){a.isShow=!a.isShow};var f=new Date;a.DocDateFrom=e("dateFilter")(f),a.DocDateTo=e("dateToFilter")(f),c.get("http://"+d+"/Api/api/DeliveryOrder?state=1").success(function(b){a.items1=b.Data;for(var c=0;c<a.items1.length;c++)a.items1[c].Actions="产品卸货"}).error(function(){}),c.get("http://"+d+"/Api/api/DeliveryOrder?state=1").success(function(b){a.items=b.Data;for(var c=0;c<a.items.length;c++)a.items[c].orderCheck="运单卸货";a.sellName=a.items;for(var d=0;d<a.sellName.length-1;d++)for(var e=d+1;e<a.sellName.length;e++)a.sellName[d].CarrierContactName==a.sellName[e].CarrierContactName&&(a.sellName.splice(e,1),e--)}).error(function(){}),a.orderCheckIn=function(b){a.items[b].orderCheck="运单完成";for(var e=a.items[b].CarrierAccountId,f=[],g=0;g<a.items1.length;g++)a.items1[g].CarrierAccountId==e&&(a.items1[g].DeliveryOrderLineState="16",a.items1[g].Actions="卸货完成",f.push(a.items1[g].Id));c.put("http://"+d+"/Api/api/DeliveryOrderLine?state=2",f).success(function(){alertInfo.Success("运单完成!")}).error(function(){alert("卸货失败")})},a.unLoad=function(b){a.list=b},a.Confirm=function(){var b=[];b.push(a.list.Id),a.list.DeliveryOrderLineState="16",c.put("http://"+d+"/Api/api/DeliveryOrderLine?state=2",b).success(function(){alertInfo.Success("产品卸货完成!")}).error(function(){alertInfo.Error("产品卸货失败")}),a.list.Actions="卸货完成"}}]),MetronicApp.controller("ProductManagementController",function(a,b){b.get("../angularjs/data/Product.json").success(function(b){a.product=b}).error(function(){})}),MetronicApp.controller("ProductShippingController",["$http","$scope","ModelService","$location","apiUrl","$filter",function(a,b,c,d,e,f){function g(a,b){for(var c=0;c<a.length-1;c++)a[c]==b.Id&&(a.splice(c,1),a.splice(a.length-1,1))}function h(c,d){var f={SalesId:b.salesId,SalesOrderId:0,Id:0,DateFrom:0,DateTo:0,ProductCode:0,CategoryId:c,StoreId:d,DeliveryPoint:[0]};a.put("http://"+e+"/Api/api/v1/Sales/SalesOrders/GetPackagingLines",f,{cache:!0}).success(function(a){b.getSalesOrder=a.Data,console.log(a.Data);for(var c=0;c<b.getSalesOrder.length;c++)b.getSalesOrder[c].Actions="打包装柜";b.totalPage=Math.ceil(b.getSalesOrder.length/b.pageSize),b.listCount=b.getSalesOrder.slice(0,b.pageSize)})}a.get("http://"+e+"/Api/api/v1/Sales/Profile").success(function(a){b.SalesInfo=a.Data,b.salesId=b.SalesInfo.SalesId,b.StoreInfo=JSON.parse(b.SalesInfo.storeInfos),h([0],[0])}),c.getCategory().success(function(a){b.category=a.Data,b.catelog=[];for(var c=0;c<b.category.length;c++)if(0==b.category[c].ParentCode){b.category[c].module=[];for(var d=0;d<b.category.length;d++)b.category[d].ParentCode==b.category[c].Id&&b.category[c].module.push(b.category[d]);b.catelog.push(b.category[c])}}).error(function(){}),b.isShowList=!0,b.ShowList=function(){b.isShowList=!b.isShowList},b.isShow=!0,b.packUpDown=function(){b.isShow=!b.isShow};var i=new Date;b.DocDateFrom=f("dateFilter")(i),b.DocDateTo=f("dateToFilter")(i),b.searchList=function(c){var d="http://"+e+"/Api/api/SalesOrder?state="+c;if(null!==b.DocDateFrom){var f=b.DocDateFrom.split("-").join("");d=d+"&dateFrom="+f}else d+="&dateFrom";if(null!==b.DocDateTo){var g=b.DocDateTo.split("-").join("");d=d+"&dateTo="+g}else d+="&dateTo";if(null!==b.ProductCode){var h=b.ProductCode;d=d+"&productCode="+h}else d+="&productCode";if(null!==b.BuyerAccountName){var i=b.BuyerAccountName;d=d+"&buyerAccountName="+i}else d+="&buyerAccountName";a.get(d).success(function(a){b.items=a.Data;for(var c=0;c<b.items.length;c++)b.items[c].isCheck=!1,b.items[c].Actions="打包装柜";b.listCount=b.items.slice(0,b.pageSize)}).error(function(){b.items=[],b.listCount=[]})},b.checkListItem=[],b.checkItems=function(a){b.checkListItem.push(a.Id),g(b.checkListItem,a),h(b.checkListItem,[0])},b.checkStoreItem=[],b.checkStore=function(a){b.checkStoreItem.push(a.StoreId),g(b.checkStoreItem,a),h([0],checkStoreItem)},b.allList=function(){h(b.salesId,[0],[0])},b.checkBox=!1,b.List=[],b.CheckElement=function(a,c){if(0==c)for(var d=0;d<b.List.length;d++)b.listCount[a].Id==b.List[d].Id&&b.List.splice(d,1);else b.List.push(b.listCount[a])},b.master=!1,b.checkAll=function(a){if(0==a){b.checkBox=!0;for(var c=0;c<b.listCount.length;c++)b.List.push(b.listCount[c])}else b.checkBox=!1,b.List=[],console.log(b.List)},b.stuckConfirm=function(){var c=[],d=[];if(b.List.length>0){for(var f=0;f<b.List.length;f++)d.push(b.List[f].DocCode);for(var g=Enumerable.From(d).Distinct().ToArray(),h=0;h<g.length;h++){for(var i=[],j=[],k=0;k<b.List.length;k++)g[h]==b.List[k].DocCode&&(j.push(b.List[k].Id),i={DocCode:g[h],SalesOrderLineIds:j});c.push(i)}a.put("http://"+e+"/Api/api/v1/Sales/SalesOrders/"+b.salesId+"/Packaging",c).success(function(){for(var a=0;a<b.List.length;a++)b.itemLength++,b.List[a].Status="13",b.List[a].Actions="取消装柜",b.createOrder.push(b.List[a]);alertInfo.Success("物流装柜完成!")}).error(function(){alertInfo.Error("物流装柜失败!")})}},b.viewModel=function(a){b.list=b.listCount[a]},b.itemLength=0,b.createOrder=[],b.Confirm=function(){"打包装柜"==b.list.Actions?a.put("http://"+e+"/Api/api/v1/Sales/SalesOrders/"+b.salesId+"/Packaging",[{DocCode:b.list.DocCode,SalesOrderLineIds:[b.list.Id]}]).success(function(){b.itemLength++,b.createOrder.push(b.list),b.list.Status="13",b.list.Actions="取消装柜",alertInfo.Success("物流装柜完成!")}).error(function(){alertInfo.Error("物流装柜失败!")}):"取消装柜"==b.list.Actions&&a.put("http://"+e+"/Api/api/v1/Sales/SalesOrders/"+b.salesId+"/CancelPackaged",[{DocCode:b.list.DocCode,SalesOrderLineIds:[b.list.Id]}]).success(function(){b.itemLength--;for(var a=0;a<b.createOrder.length;a++)b.list.Id==b.createOrder[a].Id&&b.createOrder.splice(a,1);b.list.Status="64",b.list.Actions="打包装柜",alertInfo.Success("取消物流装柜!")}).error(function(){alertInfo.Error("取消物流装柜失败!")})},b.goToCheckOut=function(){for(var c=[],d=0;d<b.createOrder.length;d++){var f={SellerId:b.salesId,SalesOrderId:b.createOrder[d].DocCode,CarrierAccountId:b.createOrder[d].CarrierAccountId,ConsigneerInfo:b.createOrder[d].ConsigneerInfo,SellerAccountInfo:b.createOrder[d].SellerInfo,SalesOrderLineId:b.createOrder[d].Id};c.push(f)}console.log(c),a.post("http://"+e+"/Api/api/v1/Sales/SalesOrders/"+b.salesId+"/MoveToDeliveryOrder",c).success(function(a){console.log(a),alertInfo.Success("生成订单成功!")}).error(function(){alertInfo.Error("请先装柜产品!")})},b.currentPage=1,b.pages=[1,2,3,4,5],b.pageSize=10,b.setPage=function(a,c){b.listCount=b.items.slice((a-1)*c,a*c),b.currentPage<=5&&(b.pages=[1,2,3,4,5]),b.currentPage>5&&(b.pages=[b.currentPage-4,b.currentPage-3,b.currentPage-2,b.currentPage-1,b.currentPage])},b.next=function(){b.currentPage<b.totalPage&&(b.currentPage++,b.setPage(b.currentPage,b.pageSize))},b.prev=function(){b.currentPage>1&&(b.currentPage--,b.setPage(b.currentPage,b.pageSize))},b.loadPage=function(a){b.currentPage=a,b.setPage(b.currentPage,b.pageSize)}}]),MetronicApp.controller("ShippingDetailController",["$http","$scope","$rootScope","$location","ModelService","apiUrl",function(a,b,c,d,e,f){b.checkContactInfo=function(a,c){b.info=a,b.ContactInfoId=c.Id},b.createOrder="生成运单",b.crateDeliver=function(){if(angular.isNumber(b.info)){"生成运单"==b.createOrder&&(b.createOrder="生成成功",alertInfo.Success("运单生成成功!")),b.testItem=[];for(var c=0;c<b.items.length;c++)b.items[c].SalesOrderLineState="26",b.testItem.push(b.items[c].SalesOrderLineId);a.put("http://"+f+"/Api/api/SalesOrderLine?state=26",b.testItem).success(function(){});for(var d=([{CarrierAccountId:b.CarrierId,CarrierContactId:b.ContactInfoId}],[]),e={CarrierAccountId:b.CarrierId,CarrierContactId:b.ContactInfoId,ShipperId:b.items[0].BuyerAccountId,ShipperContactId:b.items[0].BuyerContactId,ConsigneerId:b.items[0].SellerAccountId,ConsigneerContactId:b.items[0].SellerContactId},g={SalesOrderId:b.items[0].SalesOrderId,SalesOrderLineId:b.items[0].SalesOrderLineId,ProductId:b.items[0].ProductId,ProductBarcode:b.items[0].ProductBarcode,Qty:b.items[0].Qty},h={deliveryOrder:e,deliveryOrderLine:g},i=0;i<b.items.length;i++)d.push(h);a.post("http://"+f+"/Api/api/DeliveryOrderLine?bulk",d).success(function(){}).error(function(){alertInfo.Error("生成失败!")})}else alertInfo.Error("请先选择承运人!")}}]),MetronicApp.controller("SignUpController",["$http","$scope","$location","$timeout","authService",function(a,b,c,d,e){b.savedSuccessfully=!1,b.message="",b.registration={Email:"",password:"",confirmPassword:""},b.signUp=function(){e.saveRegistration(b.registration).then(function(a){b.savedSuccessfully=!0,b.message="注册成功！2秒中后跳转到登录页面",f()},function(a){var c=[];for(var d in a.data.modelState)for(var e=0;e<a.data.modelState[d].length;e++)c.push(a.data.modelState[d][e]);b.message="注册失败:"+c.join(" ")})};var f=function(){var a=d(function(){d.cancel(a),c.path("/login")},2e3)}}]),MetronicApp.controller("UserProfileController",function(a,b,c,d,e,f,g){a.loginName=c.authentication.userName,d.headImg=e.get(a.loginName+"image"),b.get("http://"+f+"/Api/api/v1/UserProfile").success(function(b){a.userInfo=b.Data,"null"==a.userInfo.ContactInfo&&(c.logOut(),g.url("/Login/login/html")),d.Nick=JSON.parse(a.userInfo.ContactInfo).Nick}).error(function(){c.logOut(),g.url("/Login/login/html")}),b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/userData1.json").success(function(b){a.pageData=b.data1,a.dataLenth=0;for(var c=0;c<a.pageData.length;c++)a.dataLenth=a.dataLenth+a.pageData[c];a.pageData2=b.data2,a.dataLenth2=0;for(var d=0;d<a.pageData2.length;d++)a.dataLenth2=a.dataLenth2+a.pageData2[d]}),b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/Member1.json").success(function(b){a.Member=b}),a.timeClick=function(c){b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/userData"+c+".json").success(function(b){a.pageData=b.data1,a.dataLenth=0;for(var c=0;c<a.pageData.length;c++)a.dataLenth=a.dataLenth+a.pageData[c];a.pageData2=b.data2,a.dataLenth2=0;for(var d=0;d<a.pageData2.length;d++)a.dataLenth2=a.dataLenth2+a.pageData2[d]}),b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/Member"+c+".json").success(function(b){a.Member=b}),sparkLineInit.init(c)}});