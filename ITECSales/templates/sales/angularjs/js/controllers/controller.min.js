/*! test 05-04-2016 */
MetronicApp.controller("AccountSettingController",function(a,b,c,d,e,f,g,h){a.loginName=c.authentication.userName,b.get("http://"+d+"/Api/api/v1/UserProfile").success(function(e){a.userInfo=e.Data,"null"==a.userInfo.ContactInfo&&(c.logOut(),f.url("/Login/login/html")),a.ContactInfoDetail=JSON.parse(a.userInfo.ContactInfo),a.realName=a.ContactInfoDetail.Name,a.Tel=a.ContactInfoDetail.Tel1,a.loginEmail=a.ContactInfoDetail.Email1,g.Nick=a.ContactInfoDetail.Nick,a.MainAddressInfo=JSON.parse(a.userInfo.MainAddressInfo),a.StoreInfo=JSON.parse(a.userInfo.StoreInfo),b.get("http://"+d+"/Api/api/v1/Store").success(function(b){if(a.mapAddress=b.Data,null!=a.StoreInfo)for(var c=0;c<a.mapAddress.length;c++)a.mapAddress[c].StoreId==a.StoreInfo.Id&&(a.mapAdd=a.mapAddress[c],mapFun(a.mapAdd));else a.mapAdd=a.mapAddress[0],mapFun(a.mapAdd)}),a.userId=a.ContactInfoDetail.Id,a.Identity=a.userInfo.Identity,a.AddressInfo=JSON.parse(a.userInfo.AddressInfo);for(var h=0;h<a.AddressInfo.length;h++){a.AddressInfo[h].defaultSet=!1,a.AddressInfo[h].Id==a.MainAddressInfo[0].Id&&(a.AddressInfo[h].defaultSet=!0);var i=JSON.parse(a.AddressInfo[h].StrExt2),j=a.AddressInfo[h].AddressLine2,k="",l="";-1!=j.lastIndexOf("区")?(k=j.substring(0,j.lastIndexOf("区")+1),l=j.substring(j.lastIndexOf("区")+1)):-1!=j.lastIndexOf("县")?(k=j.substring(0,j.lastIndexOf("县")+1),l=j.substring(j.lastIndexOf("县")+1)):-1!=j.lastIndexOf("旗")?(k=j.substring(0,j.lastIndexOf("旗")+1),l=j.substring(j.lastIndexOf("旗")+1)):-1!=j.lastIndexOf("市")&&(k=j.substring(0,j.lastIndexOf("市")+1),l=j.substring(j.lastIndexOf("市")+1)),a.AddressInfo[h].addDetail=k,a.AddressInfo[h].area=l,a.AddressInfo[h].TelAndPhone=i}if(null!=a.userInfo.PaymentInfo){a.PaymentInfo=a.userInfo.PaymentInfo.split("|"),a.payInfo=[];for(var m=0;m<a.PaymentInfo.length;m++){var n=a.PaymentInfo[m].split(":")[1];a.payInfo.push(n)}a.CardNumber=a.payInfo[0],a.CardName=a.payInfo[1],a.IdCard=a.payInfo[2],a.CardPhone=a.payInfo[3]}a.InvoiceInfo=JSON.parse(a.userInfo.InvoiceInfo),null!=a.InvoiceInfo?(a.invoiceId=a.InvoiceInfo.Id,a.invoiceName=a.InvoiceInfo.Name,a.invoiceNumber=a.InvoiceInfo.Code,a.invoiceAddressAndPhone=a.InvoiceInfo.AddressLine,a.bankLine=a.InvoiceInfo.BankLine):a.invoiceId=0,b.get("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/MarketInfo").success(function(b){if(a.marketInfo=b.Data,null!=a.marketInfo){a.marketId=a.marketInfo.Id,a.birthDay=a.marketInfo.Birthday.substring(0,a.marketInfo.Birthday.indexOf(" ")),a.bikeClub=a.marketInfo.ClubInfo,a.checkItem=a.marketInfo.PurchaseIntention;for(var c=0;c<a.purchase.length;c++)a.purchase[c].intention==a.checkItem&&(a.checkId=a.purchase[c].Id);a.checkSaleItem=a.marketInfo.SalesInfoChannel;for(var d=0;d<a.SalesInfoChannel.length;d++)a.SalesInfoChannel[d].channel==a.checkSaleItem&&(a.checkSalesId=a.SalesInfoChannel[d].Id)}else a.marketId=0})}).error(function(){c.logOut(),f.url("/Login/login/html")}),a.saveForm=function(){var c={Id:a.userId,Name:a.realName,Tel:a.Tel,Nick:a.Nick};b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/ContactInfo",c).success(function(){g.Nick=a.Nick,alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})},a.updatePwd=function(){a.newPassword==a.confirmPassword?b.post("http://192.168.1.10:8083/api/account/ChangePassword",{UserName:a.loginName,CurrentPassword:a.password,NewPassword:a.newPassword}).success(function(){alertInfo.Success("密码修改成功!"),c.logOut(),i()}).error(function(){alertInfo.Error("修改失败!")}):alertInfo.Error("两次密码不一致!")};var i=function(){var a=e(function(){e.cancel(a),f.path("/login")},2e3)};a.getImg=function(){var b=document.getElementsByTagName("img");g.headImg=b[4].src,h.set(a.loginName+"image",g.headImg),alertInfo.Success("保存成功!")},b.get("/data/ProJson.json").success(function(b){a.getProvince=b}),b.get("/data/CityJson.json").success(function(b){a.City=b}),b.get("/data/DistrictJson.json").success(function(b){a.Street=b}),a.getCity=[],a.getProData=function(b){if(a.getCity=[],a.selCity=[],a.selStreet=[],null!=b){a.selectProvince=b.ProName;for(var c=0;c<a.City.length;c++)a.selProvince.ProID==a.City[c].ProID&&a.getCity.push(a.City[c])}},a.getStreet=[],a.getCityData=function(b){if(a.getStreet=[],a.selStreet=0,null!=b){a.selectCity=b.CityName;for(var c=0;c<a.Street.length;c++)a.selCity.CityID==a.Street[c].CityID&&a.getStreet.push(a.Street[c])}},a.getStreetData=function(b){null!=b&&(a.selectStreet=b.DisName)},a.defaultCheck=!1,a.setDefault=function(){},a.isChecked=function(a){return!!a},a.saveInfo=function(){null==a.listId&&(a.listId=0);var c={Id:a.listId,ContactWay:{Consignee:a.acceptName,Tel:a.telNumber,Phone:a.phoneNum},Province:a.selectProvince,City:a.selectCity,Street:a.selectStreet,AddressLine1:"",ZipCode:a.codeNum,AddressLine2:a.selectProvince+a.selectCity+a.selectStreet+a.detailAddress,DefaultAddress:a.defaultCheck},e={Name:a.acceptName,addDetail:a.selectProvince+a.selectCity+a.selectStreet,AddressLine2:a.selectProvince+a.selectCity+a.selectStreet+a.detailAddress,ZipCode:a.codeNum,TelAndPhone:{Tel:a.telNumber,Phone:a.phoneNum},defaultSet:a.defaultCheck};if(c.DefaultAddress)for(var f=0;f<a.AddressInfo.length;f++)a.AddressInfo[f].defaultSet=!1;b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/AddressInfo",c).success(function(){0==c.Id?a.AddressInfo.push(e):a.AddressInfo.splice(a.listIndex,1,e),alertInfo.Success("保存成功！"),a.defaultCheck=!1,j()}).error(function(){alertInfo.Error("保存失败!")})};var j=function(){a.selProvince="",a.selCity="",a.selStreet="",a.acceptName="",a.phoneNum="",a.telNumber="",a.codeNum="",a.detailAddress="",a.defaultCheck=!1};a.updateInfo=function(b){a.listId=a.AddressInfo[b].Id,a.listIndex=b,a.acceptName=a.AddressInfo[b].Name,a.phoneNum=a.AddressInfo[b].TelAndPhone.Phone,a.telNumber=a.AddressInfo[b].TelAndPhone.Tel,a.codeNum=a.AddressInfo[b].ZipCode,a.detailAddress=a.AddressInfo[b].area,a.defaultCheck=a.AddressInfo[b].defaultSet,a.selectProvince=a.AddressInfo[b].Province,a.selectCity=a.AddressInfo[b].City,a.selectStreet=a.AddressInfo[b].Street},a.viewModal=function(b){a.delIndex=b},a.deleteInfo=function(){b["delete"]("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/"+a.AddressInfo[a.delIndex].Id).success(function(){}),a.AddressInfo.splice(a.delIndex,1)},a.showDefault=function(b){if(0==a.AddressInfo[b].defaultSet){for(var c=0;c<a.AddressInfo.length;c++)a.AddressInfo[c].showSet=!1;a.AddressInfo[b].showSet=!0}},a.hideDefault=function(){for(var b=0;b<a.AddressInfo.length;b++)a.AddressInfo[b].showSet=!1},a.changeAddress=function(c){for(var e=0;e<a.AddressInfo.length;e++)a.AddressInfo[e].showSet=!1,a.AddressInfo[e].defaultSet=!1;b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/Address/"+a.AddressInfo[c].Id).success(function(){a.AddressInfo[c].defaultSet=!0,alertInfo.Success("修改成功!")}).error(function(){alertInfo.Error("修改失败!")})},a.bankInfo=function(){var c={CardNo:a.CardNumber,Name:a.CardName,Identity:a.IdCard,Tel:a.CardPhone};b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/PayInfo",c).success(function(){alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})},a.invoiceInfo=function(){var c={Id:a.invoiceId,Name:a.invoiceName,AddressLine:a.invoiceAddressAndPhone,Code:a.invoiceNumber,BankLine:a.bankLine};b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/InvoiceInfo",c).success(function(){alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("更新失败!")})},a.saveAddress=function(){b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/Store/"+a.mapAdd.StoreId).success(function(){alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})},a.getMap=function(b){a.mapAdd=b,mapFun(b)},a.purchase=[{intention:"自己使用",Id:0,"for":"self"},{intention:"送朋友",Id:1,"for":"friend"},{intention:"收藏",Id:2,"for":"collection"},{intention:"其他",Id:3,"for":"else"}],a.SalesInfoChannel=[{channel:"偶然发现",Id:0,"for":"find"},{channel:"朋友介绍",Id:1,"for":"command"},{channel:"店铺推荐",Id:2,"for":"prefer"},{channel:"其他",Id:3,"for":"something"}],a.checkPurchase=function(b,c){a.checkId=c,a.checkItem=b.intention},a.checkChannel=function(b,c){a.checkSalesId=c,a.checkSaleItem=b.channel},a.saveSaleInfo=function(){var c={Id:a.marketId,Birthday:a.birthDay,ClubInfo:a.bikeClub,PurchaseIntention:a.checkItem,SalesInfoChannel:a.checkSaleItem};b.put("http://"+d+"/Api/api/v1/UserProfile/"+a.Identity+"/MarketInfo",c).success(function(){alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})}}),MetronicApp.controller("CheckOutController",["SalesService","localStorageService","$timeout","$http","$scope","$rootScope","$location","apiUrl","authService",function(a,b,c,d,e,f,g,h,i){function j(){var a={SalesOrderId:e.salesOrderId,BuyerId:e.Identity,PageIndex:0,PageSize:0};d.put("http://"+h+"/Api/api/v1/me/SalesOrders/Submitted",a).success(function(a){if(e.orderInfo=a.Data,""!=e.orderInfo){e.orderId=e.orderInfo[0].Id,e.totalPrice=0;for(var b=0;b<e.orderInfo[0].SalesOrderLines.length;b++)e.totalPrice+=e.orderInfo[0].SalesOrderLines[b].ProductQty*e.orderInfo[0].SalesOrderLines[b].SalesPrice,e.orderInfo[0].SalesOrderLines[b].showBtn=!1}else g.path("/sales/productList.html")})}e.loginName=i.authentication.userName,e.salesOrderId=b.get("salesOrderId"),d.get("http://"+h+"/Api/api/v1/UserProfile").success(function(a){e.userInfo=a.Data,console.log(e.userInfo),"null"==e.userInfo.ContactInfo&&(i.logOut(),g.url("/Login/login/html")),e.Identity=e.userInfo.Identity,e.StoreInfo=JSON.parse(e.userInfo.StoreInfo),e.storeId=e.StoreInfo.Id,e.MainAddressInfo=JSON.parse(e.userInfo.MainAddressInfo),e.AddressInfo=JSON.parse(e.userInfo.AddressInfo);for(var b=0;b<e.AddressInfo.length;b++)e.AddressInfo[b].contact=JSON.parse(e.AddressInfo[b].StrExt2),e.AddressInfo[b].Name==e.MainAddressInfo[0].Name&&(e.AddressInfo.unshift(e.AddressInfo[b]),e.AddressInfo.splice(b+1,1));j()}),e.info=0,e.checkAddress=function(a,b){var c=a.Id;e.info=b,d.put("http://"+h+"/Api/api/v1/me/SalesOrders/"+e.Identity+"/"+e.salesOrderId+"/ConsigneeAddress/"+c).success(function(){}).error(function(){})},e.isShow=!1,e.ShowDropDown=function(){e.isShow=!e.isShow},e.showButton=function(a){e.orderInfo[0].SalesOrderLines[a].showBtn=!0},e.hideButton=function(a){e.orderInfo[0].SalesOrderLines[a].showBtn=!1},e.backShoppingCart=function(b){var c={StoreId:e.storeId,BuyerAccountId:e.Identity,ProductId:b.ProductId,ListPrice:b.ListPrice,ProductColor:b.ProductColor,ProductSize:b.ProductSize,Qty:b.ProductQty};d.post("http://"+h+"/Api/api/v1/me/ShoppingCart",c).success(function(){d.put("http://"+h+"/Api/api/v1/me/SalesOrders/Delete/Lines/"+b.Id).success(function(){a.shoppingCart(e.Identity).success(function(a){f.listCart=a.Data,j(),alertInfo.Success("移入购物车成功!")}).error(function(){alertInfo.Error("移入购物车失败")})}).error(function(){alertInfo.Error("删除失败")})}).error(function(){alertInfo.Error("移入购物车失败!")})},e.add=function(a){e.orderInfo[0].SalesOrderLines[a].ProductQty++;var b={SalesOrderLineId:e.orderInfo[0].SalesOrderLines[a].Id,Qty:e.orderInfo[0].SalesOrderLines[a].ProductQty,UserIdentity:e.Identity};d.put("http://"+h+"/Api/api/v1/me/SalesOrders/LinesQty",b).success(function(){e.totalPrice+=e.orderInfo[0].SalesOrderLines[a].SalesPrice}).error(function(){})},e.subtract=function(a){if(e.orderInfo[0].SalesOrderLines[a].ProductQty>1){e.orderInfo[0].SalesOrderLines[a].ProductQty--;var b={SalesOrderLineId:e.orderInfo[0].SalesOrderLines[a].Id,Qty:e.orderInfo[0].SalesOrderLines[a].ProductQty,UserIdentity:e.Identity};d.put("http://"+h+"/Api/api/v1/me/SalesOrders/LinesQty",b).success(function(){e.totalPrice-=e.orderInfo[0].SalesOrderLines[a].SalesPrice}).error(function(){})}},e.cancelSalesOrder=function(){d["delete"]("http://"+h+"/Api/api/v1/me/SalesOrders/"+e.orderId).success(function(){alertInfo.Success("取消成功!"),g.url("/sales/productList/all")}).error(function(){alertInfo.Error("取消失败")})},e.confirmSalesOrder=function(){d.put("http://"+h+"/Api/api/v1/me/SalesOrders/"+e.Identity+"/ConfirmSalesOrder/"+e.orderId).success(function(){alertInfo.Success("确认成功!"),g.url("/sales/payment.html"),f.orderLength++})}}]),MetronicApp.controller("CompanySettingController",function(a,b,c,d,e,f){a.loginName=c.authentication.userName,b.get("http://"+e+"/Api/api/v1/Enterprise/GeneralTitle").success(function(b){a.GeneralTitle=b.Data}),b.get("http://"+e+"/Api/api/v1/Enterprise/GeneralRole").success(function(b){a.GeneralRole=b.Data}),b.get("http://"+e+"/Api/api/v1/Enterprise/GeneralDepartment").success(function(b){a.GeneralDepartment=b.Data}),b.get("http://"+e+"/Api/api/v1/UserProfile").success(function(d){a.userInfo=d.Data,"null"==a.userInfo.ContactInfo&&(c.logOut(),f.url("/Login/login/html")),a.parentId=a.userInfo.ParentId,b.get("http://"+e+"/Api/api/v1/Enterprise/"+a.parentId).success(function(b){a.company=b.Data,a.defaultCompanyName=a.company.Name,a.companyAbbr=a.company.Abbr,a.contactList=a.company.Contacts;for(var c=0;c<a.contactList.length;c++){a.contactList[c].defaultSet=!1,a.contactList[c].Name==a.company.ContactName&&(a.contactList[c].defaultSet=!0);for(var d=0;d<a.GeneralDepartment.length;d++)a.contactList[c].Department==a.GeneralDepartment[d].Id&&(a.contactList[c].Department=a.GeneralDepartment[d].Description);for(var e=0;e<a.GeneralRole.length;e++)a.contactList[c].Role==a.GeneralRole[e].Id&&(a.contactList[c].Role=a.GeneralRole[e].Description)}}),a.ContactInfo=JSON.parse(a.userInfo.ContactInfo),a.defaultName=a.ContactInfo.Name,a.defaultTel=a.ContactInfo.Tel1,a.contactId=a.ContactInfo.Id,a.MainAddressInfo=JSON.parse(a.userInfo.MainAddressInfo),""!=a.MainAddressInfo&&(a.addressId=a.MainAddressInfo[0].Id,a.defaultAddress=a.MainAddressInfo[0].AddressLine2),a.Identity=a.userInfo.Identity}).error(function(){c.logOut(),f.url("/Login/login/html")}),a.companySave=function(){var c={Id:a.parentId,ContactId:a.contactId,AddressId:a.addressId,Name:a.defaultCompanyName,Abbr:a.companyAbbr};b.put("http://"+e+"/Api/api/v1/Enterprise/"+a.Identity+"/EnterpriseInfo",c).success(function(){alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})};var g=function(b){for(var c=0;c<b.length;c++)b[c].defaultSet&&(a.defaultName=b[c].Name,a.defaultTel=b[c].Tel1)};b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/ProJson.json").success(function(b){a.getProvince=b}),b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/CityJson.json").success(function(b){a.City=b}),b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/DistrictJson.json").success(function(b){a.Street=b}),a.selProvince=[],a.getCity=[],a.getProData=function(b){if(a.getCity=[],a.selCity=[],a.selStreet=[],null!=b){a.selectProvince=b.ProName;for(var c=0;c<a.City.length;c++)a.selProvince.ProID==a.City[c].ProID&&a.getCity.push(a.City[c])}},a.getStreet=[],a.getCityData=function(b){if(a.getStreet=[],a.selStreet=0,null!=b){a.selectCity=b.CityName;for(var c=0;c<a.Street.length;c++)a.selCity.CityID==a.Street[c].CityID&&a.getStreet.push(a.Street[c])}},a.getStreetData=function(b){null!=b&&(a.selectStreet=b.DisName)},a.defaultCheck=!1,a.setDefault=function(){1==a.defaultCheck?a.defaultCheck=!1:a.defaultCheck=!0},a.saveInfo=function(){null==a.listId&&(a.listId=0);var c={Contact:{Id:a.listId,Name:a.acceptName,Email1:a.email,Department:a.department.Id,Title:a.title.Id,Role:a.role.Id,Tel1:a.telNumber,Tel2:a.phoneNum},UserIdentity:a.Identity,EnterpriseId:a.parentId,IsDefaultContact:a.defaultCheck},d={Department:a.department.Description,Title:a.title.Description,Role:a.role.Description,Name:a.acceptName,Email1:a.email,Tel1:a.telNumber,Tel2:a.phoneNum,defaultSet:a.defaultCheck};if(c.IsDefaultContact)for(var f=0;f<a.contactList.length;f++)a.contactList[f].defaultSet=!1;b.put("http://"+e+"/Api/api/v1/Enterprise/Contact",c).success(function(){0==c.Contact.Id?(a.contactList.push(d),g(a.contactList)):a.contactList.splice(a.list,1,d),alertInfo.Success("保存成功!"),h()}).error(function(){alertInfo.Error("保存失败!")})};var h=function(){a.acceptName="",a.phoneNum="",a.telNumber="",a.email="",a.department="",a.title="",a.role="",a.defaultCheck=!1};a.updateInfo=function(b){a.listId=a.contactList[b].Id,a.list=b,a.acceptName=a.contactList[b].Name,a.phoneNum=a.contactList[b].Tel2,a.telNumber=a.contactList[b].Tel1,a.email=a.contactList[b].Email1,a.defaultCheck=a.contactList[b].defaultSet},a.viewModal=function(b){a.delIndex=b},a.deleteInfo=function(){a.contactList.splice(a.delIndex,1),g(a.contactList)},a.showDefault=function(b){if(0==a.contactList[b].defaultSet){for(var c=0;c<a.contactList.length;c++)a.contactList[c].showSet=!1;a.contactList[b].showSet=!0}},a.hideDefault=function(){for(var b=0;b<a.contactList.length;b++)a.contactList[b].showSet=!1},a.changeAddress=function(c){for(var d=0;d<a.contactList.length;d++)a.contactList[d].showSet=!1,a.contactList[d].defaultSet=!1;b.put("http://"+e+"/Api/api/v1/Enterprise/"+a.parentId+"/DefaultContact/"+a.contactList[c].Id).success(function(){a.contactList[c].defaultSet=!0,g(a.contactList),alertInfo.Success("设置成功!")}).error(function(){alertInfo.Error("设置失败!")})}}),MetronicApp.controller("indexController",["$scope","$location","$window","authService",function(a,b,c,d){a.authentication=d.authentication,0==a.authentication.isAuth&&(d.logOut(),a.authentication.isAuth=!1,b.url("/Login/login.html"))}]),MetronicApp.controller("LoginController",["$scope","$location","$rootScope","authService","$http","apiUrl","localStorageService",function(a,b,c,d,e,f,g){d.authentication.isAuth?b.url("/sales/productList/all"):d.logOut(),a.loginData={userName:"",password:""},a.message="",a.login=function(){d.login(a.loginData).then(function(c){e.get("http://"+f+"/Api/api/v1/UserProfile").success(function(d){a.userProfile=d.Data,console.log(d.Data),null==g.get(c.userName+"image")&&g.set(c.userName+"image","/assets/admin/pages/media/profile/profile_user.jpg"),b.path("/sales/productList/all").replace(),top.location.reload()}).error(function(){d.logOut(),alertInfo.Error("登录失败!")})},function(b){a.message=b.error_description})}}]),MetronicApp.controller("MyOrderListController",["authService","ListService","$scope","apiUrl","$http","localStorageService","$location",function(a,b,c,d,e,f,g){e.get("http://"+d+"/Api/api/v1/UserProfile").success(function(d){c.userInfo=d.Data,"null"==c.userInfo.ContactInfo&&(a.logOut(),g.url("/Login/login/html")),c.Identity=c.userInfo.Identity,c.StoreInfo=JSON.parse(c.userInfo.StoreInfo),c.storeId=c.StoreInfo.Id,c.MainAddressInfo=JSON.parse(c.userInfo.MainAddressInfo),c.ContactWay=JSON.parse(c.MainAddressInfo[0].StrExt2),c.orderPayInfo=[],c.orderDeliverInfo=[],b.totalOrders(c.Identity).success(function(a){c.orderInfo=a.Data,console.log(a.Data);for(var b=0;b<c.orderInfo.length;b++)c.orderInfo[b].Status<3?c.orderPayInfo.push(c.orderInfo[b]):c.orderInfo[b].Status<=128&&c.orderDeliverInfo.push(c.orderInfo[b]);c.listCount=c.orderInfo.slice(0,10),c.totalPage=Math.ceil(c.orderInfo.length/10),c.salesOrderLine=c.orderInfo.SalesOrderLines}),e.get("../angularjs/data/package.json").success(function(a){c.orderReviewInfo=a})}),c.isShow=!1,c.ShowDropDown=function(){c.isShow=!c.isShow},c.confirmPay=function(a){e.put("http://"+d+"/Api/api/v1/me/SalesOrders/"+c.Identity+"/PaidSalesOrder/"+c.orderPayInfo[a].Id).success(function(){c.orderPayInfo.splice(a,1),alertInfo.Success("付款成功!"),b.deliveryOrders(c.Identity).success(function(a){c.orderDeliverInfo=a.Data})}).error(function(){alertInfo.Error("付款失败!")})},c.confirmDeliver=function(a){e.put("http://"+d+"/Api/api/v1/me/SalesOrders/"+c.Identity+"/FinishedSalesOrder/"+c.orderDeliverInfo[a].Id).success(function(){c.orderDeliverInfo.splice(a,1),alertInfo.Success("收货成功!")}).error(function(){alertInfo.Error("收货失败!")})},c.confirmReceive=function(a){},c.viewOrderDetail=function(a){var b=a.Status,c=0;switch(b){case 1:case 2:c=1;break;case 4:case 8:case 16:case 32:case 64:case 128:c=2;break;case 256:c=3;break;case 512:c=4}f.set("listData",a),f.set("currentStatus",c),g.path("/sales/orderDetail.html")},c.items=[{Name:"全部订单",status:0},{Name:"待付款",status:2},{Name:"待发货",status:4},{Name:"待收货",status:32}],c.item=c.items[0],c.status=c.item.status,c.changeStatus=function(a){c.status=a.status},c.searchProduct=function(){var a={BuyerId:c.Identity,Status:c.status,DateFrom:c.dateFrom,DateTo:c.dateTo,ProductName:c.productName,ProductCode:c.productCode,SalesOrderId:c.salesOrderId};e.put("http://"+d+"/Api/api/v1/me/SalesOrders/GetLines",a).success(function(a){c.searchResult=a.Data})},c.saveReview=function(){var a={UserId:c.Identity,RefTypeStr:"订单",RefId:c.orderLineRev.Id,LineId:c.orderLineRev.CatalogId,Comments:c.reviewText,ParentId:0};e.post("http://"+d+"/Api/api/v1/me/Comments",a).success(function(){c.reviewName="",c.reviewText="",c.reviewTel="",alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})},c.currentPage=1,c.pageSize=10,c.pages=[1,2,3,4,5],c.setPage=function(a,b){c.listCount=c.orderInfo.slice((a-1)*b,a*b),c.currentPage<=5&&(c.pages=[1,2,3,4,5]),c.currentPage>5&&(c.pages=[c.currentPage-4,c.currentPage-3,c.currentPage-2,c.currentPage-1,c.currentPage])},c.next=function(){c.currentPage<c.totalPage&&(c.currentPage++,c.setPage(c.currentPage,c.pageSize))},c.prev=function(){c.currentPage>1&&(c.currentPage--,c.setPage(c.currentPage,c.pageSize))},c.loadPage=function(a){c.currentPage=a,c.setPage(c.currentPage,c.pageSize)}}]),MetronicApp.controller("OrderDetailController",["$http","$scope","localStorageService",function(a,b,c){var d=c.get("currentStatus");b.List=c.get("listData");var e=b.List.ConsignneInfo,f=e.lastIndexOf("}");if(-1!=f){var g=JSON.parse(e.substring(0,f+1));b.List.ConsignneInfo=e.substring(f+1),b.List.ConsigneeTel=g.Tel,b.List.ConsigneePhone=g.Phone}b.total=0;for(var h=0;h<b.List.SalesOrderLines.length;h++)b.total+=b.List.SalesOrderLines[h].ProductQty*b.List.SalesOrderLines[h].SalesPrice;FormWizard.init(d)}]),MetronicApp.controller("PaymentController",["$http","$scope",function(a,b){}]),MetronicApp.controller("ProductController",["authService","SalesService","apiUrl","$scope","$rootScope","$http","$timeout","$location","$stateParams","localStorageService",function(a,b,c,d,e,f,g,h,i,j){d.loginName=a.authentication.userName,f.get("http://"+c+"/Api/api/v1/UserProfile").success(function(c){d.userInfo=c.Data,"null"==d.userInfo.ContactInfo&&(a.logOut(),h.url("/Login/login/html")),d.Identity=d.userInfo.Identity,j.set("Identity",d.Identity),d.StoreInfo=JSON.parse(d.userInfo.StoreInfo),d.storeId=d.StoreInfo.Id,j.set("storeId",d.storeId),b.shoppingCart(d.Identity).success(function(a){e.listCart=a.Data})}),f.get("http://"+c+"/Api/api/v1/ProductCatalog").success(function(a){d.itemList=a.Data;for(var b=0;b<d.itemList.length;b++)d.itemList[b].quantity=1;switch(d.listId=i.listType,d.FilterItem=[],d.getFilterItem=function(a){for(var b=0;b<d.itemList.length;b++)d.itemList[b].CatalogId==a&&d.FilterItem.push(d.itemList[b])},d.listId){case"all":d.FilterItem=d.itemList;break;case"4430":d.getFilterItem("4430");break;case"4431":d.getFilterItem("4431");break;case"4432":d.getFilterItem("4432");break;case"4433":d.getFilterItem("4433");break;case"4434":d.getFilterItem("4434");break;case"4435":d.getFilterItem("4435");break;case"4436":d.getFilterItem("4436");break;case"4437":d.getFilterItem("4437");break;case"4438":d.getFilterItem("4438");break;case"4439":d.getFilterItem("4439");break;case"4440":d.getFilterItem("4440");break;case"4441":d.getFilterItem("4441");break;case"4442":d.getFilterItem("4442");break;case"4443":d.getFilterItem("4443");break;case"4444":d.getFilterItem("4444");break;case"4445":d.getFilterItem("4445");break;case"4446":d.getFilterItem("4446");break;case"4447":d.getFilterItem("4447");break;case"4448":d.getFilterItem("4448");break;case"4449":d.getFilterItem("4449");break;case"4450":d.getFilterItem("4450");break;case"4451":d.getFilterItem("4451");break;case"4452":d.getFilterItem("4452");break;case"4453":d.getFilterItem("4453");break;case"4454":d.getFilterItem("4454");break;case"4455":d.getFilterItem("4455");break;case"4456":d.getFilterItem("4456");break;default:d.FilterItem=d.itemList}d.len=d.FilterItem.length,d.totalPage=Math.ceil(d.len/d.pageSize),d.listCount=d.FilterItem.slice(0,d.pageSize)}),d.viewDetail=function(a){d.productItem=a,f.get("http://"+c+"/Api/api/v1/ProductCatalog/"+a.CatalogId+"/"+d.storeId+"/Products").success(function(a){d.specification=a.Data,d.ProductColor=[],d.ProductSize=[],d.Stock=[],d.ProductId=[],d.Price=[],d.SalesPrice=[];for(var b=0;b<d.specification.length;b++)null!=d.specification[b].ProductColor&&d.ProductColor.push(d.specification[b].ProductColor),d.ProductSize.push(d.specification[b].ProductSize),d.Stock.push(d.specification[b].StockQty),d.ProductId.push(d.specification[b].ProductId),d.Price.push(d.specification[b].Price),d.SalesPrice.push(d.specification[b].SalesPrice);d.ProductSize=Enumerable.From(d.ProductSize).Distinct().ToArray(),d.ProductColor=Enumerable.From(d.ProductColor).Distinct().ToArray(),d.color=d.ProductColor[0],d.size=d.ProductSize[0],d.stockQty=d.Stock[0],d.id=d.ProductId[0],d.price=d.Price[0],d.SalesPrice=d.SalesPrice[0]})},d.changeSize=function(a){d.getSize=a,d.ProductColor=[],d.Stock=[],d.ProductId=[],d.Price=[],d.SalesPrice=[];for(var b=0;b<d.specification.length;b++)d.specification[b].ProductSize==a&&(null!=d.specification[b].ProductColor&&d.ProductColor.push(d.specification[b].ProductColor),d.Stock.push(d.specification[b].StockQty),d.ProductId.push(d.specification[b].ProductId),d.Price.push(d.specification[b].Price),d.SalesPrice.push(d.specification[b].SalesPrice));d.ProductColor=Enumerable.From(d.ProductColor).Distinct().ToArray(),d.color=d.ProductColor[0],d.stockQty=d.Stock[0],d.id=d.ProductId[0],d.price=d.Price[0],d.SalesPrice=d.SalesPrice[0]},d.changeColor=function(a){if(d.getColor=a,d.Stock=[],d.ProductId=[],null==d.getSize)for(var b=0;b<d.specification.length;b++)d.specification[b].ProductColor==a&&(d.specification[b].ProductSize==d.size?(d.stockQty=d.specification[b].StockQty,d.id=d.specification[b].ProductId,d.price=d.specification[b].Price,d.SalesPrice=d.specification[b].SalesPrice,d.stockId=d.specification[b].StockId):(d.size=d.specification[b].ProductSize,d.stockQty=d.specification[b].StockQty,d.id=d.specification[b].ProductId,d.price=d.specification[b].Price,d.SalesPrice=d.specification[b].SalesPrice,d.stockId=d.specification[b].StockId));else for(var c=0;c<d.specification.length;c++)d.specification[c].ProductSize==d.getSize&&d.specification[c].ProductColor==a&&(d.stockQty=d.specification[c].StockQty,d.id=d.specification[c].ProductId,d.price=d.specification[c].Price,d.SalesPrice=d.specification[c].SalesPrice,d.stockId=d.specification[c].StockId)},d.shoppingCart=function(){d.productItem.ProductSize=d.size,d.productItem.ProductColor=d.color;var a={StoreId:d.storeId,ProductId:d.id,ListPrice:d.productItem.Price,BuyerAccountId:d.Identity,ProductColor:d.productItem.ProductColor,ProductSize:d.productItem.ProductSize,Qty:d.productItem.quantity};f.post("http://"+c+"/Api/api/v1/me/ShoppingCart",a).success(function(){b.shoppingCart(d.Identity).success(function(a){e.listCart=a.Data,alertInfo.Success("成功加入购物车!")})}).error(function(){alertInfo.Error("加入购物车失败!")})},d.addToCart=function(a){var g={StoreId:d.storeId,ProductId:a.ProductId,ListPrice:a.Price,BuyerAccountId:d.Identity,ProductColor:a.ProductColor,ProductSize:a.ProductSize,Qty:a.quantity};f.post("http://"+c+"/Api/api/v1/me/ShoppingCart",g).success(function(){b.shoppingCart(d.Identity).success(function(a){e.listCart=a.Data,alertInfo.Success("成功加入购物车!")})}).error(function(){alertInfo.Error("加入购物车失败!")})},d.selectedList="ProductId",d.add=function(){d.productItem.quantity++},d.subtract=function(){d.productItem.quantity>1&&d.productItem.quantity--},d.showPageSize=[{pageSize:12},{pageSize:24},{pageSize:36},{pageSize:48},{pageSize:60}],d.pageSize=d.showPageSize[0].pageSize,d.pageChange=function(){d.listCount=d.FilterItem.slice(0,d.pageSize)},d.currentPage=1,d.pages=[1,2,3,4,5],d.setPage=function(a,b){d.listCount=d.FilterItem.slice((a-1)*b,a*b),d.currentPage<=5&&(d.pages=[1,2,3,4,5]),d.currentPage>5&&(d.pages=[d.currentPage-4,d.currentPage-3,d.currentPage-2,d.currentPage-1,d.currentPage])},d.next=function(){d.currentPage<d.totalPage&&(d.currentPage++,d.setPage(d.currentPage,d.pageSize))},d.prev=function(){d.currentPage>1&&(d.currentPage--,d.setPage(d.currentPage,d.pageSize))},d.loadPage=function(a){d.currentPage=a,d.setPage(d.currentPage,d.pageSize)},d.getListItem=function(a){a.listId=d.listId,j.set("item",a),d.link="/sales/productDetail.html",h.url(d.link)}}]),MetronicApp.controller("ProductDetailController",["$http","$scope","$rootScope","SalesService","$timeout","$location","apiUrl","localStorageService",function(a,b,c,d,e,f,g,h){b.getItem=h.get("item"),b.getUrlId=b.getItem.listId,b.storeId=h.get("storeId"),b.Identity=h.get("Identity"),d.shoppingCart(b.Identity).success(function(a){c.listCart=a.Data}),a.get("http://"+g+"/Api/api/v1/ProductCatalog/"+b.getItem.CatalogId+"/"+b.storeId+"/Products").success(function(a){b.specification=a.Data,b.ProductColor=[],b.ProductSize=[],b.Stock=[],b.ProductId=[],b.Price=[],b.SalesPrice=[];for(var c=0;c<b.specification.length;c++)null!=b.specification[c].ProductColor&&b.ProductColor.push(b.specification[c].ProductColor),b.ProductSize.push(b.specification[c].ProductSize),b.Stock.push(b.specification[c].StockQty),b.ProductId.push(b.specification[c].ProductId),b.Price.push(b.specification[c].Price),b.SalesPrice.push(b.specification[c].SalesPrice);b.ProductSize=Enumerable.From(b.ProductSize).Distinct().ToArray(),b.ProductColor=Enumerable.From(b.ProductColor).Distinct().ToArray(),b.color=b.ProductColor[0],b.size=b.ProductSize[0],b.stockQty=b.Stock[0],b.id=b.ProductId[0],b.price=b.Price[0],b.SalesPrice=b.SalesPrice[0]}),b.changeSize=function(a){b.getSize=a,b.ProductColor=[],b.Stock=[],b.ProductId=[],b.Price=[],b.SalesPrice=[];for(var c=0;c<b.specification.length;c++)b.specification[c].ProductSize==a&&(null!=b.specification[c].ProductColor&&b.ProductColor.push(b.specification[c].ProductColor),b.Stock.push(b.specification[c].StockQty),b.ProductId.push(b.specification[c].ProductId),b.Price.push(b.specification[c].Price),b.SalesPrice.push(b.specification[c].SalesPrice));b.ProductColor=Enumerable.From(b.ProductColor).Distinct().ToArray(),b.color=b.ProductColor[0],b.stockQty=b.Stock[0],b.id=b.ProductId[0],b.price=b.Price[0],b.SalesPrice=b.SalesPrice[0]},b.changeColor=function(a){if(b.getColor=a,b.Stock=[],b.ProductId=[],null==b.getSize)for(var c=0;c<b.specification.length;c++)b.specification[c].ProductColor==a&&(b.specification[c].ProductSize==b.size?(b.stockQty=b.specification[c].StockQty,b.id=b.specification[c].ProductId,b.price=b.specification[c].Price,b.SalesPrice=b.specification[c].SalesPrice,b.stockId=b.specification[c].StockId):(b.size=b.specification[c].ProductSize,b.stockQty=b.specification[c].StockQty,b.id=b.specification[c].ProductId,b.price=b.specification[c].Price,b.SalesPrice=b.specification[c].SalesPrice,b.stockId=b.specification[c].StockId));else for(var d=0;d<b.specification.length;d++)b.specification[d].ProductSize==b.getSize&&b.specification[d].ProductColor==a&&(b.stockQty=b.specification[d].StockQty,b.id=b.specification[d].ProductId,b.price=b.specification[d].Price,b.SalesPrice=b.specification[d].SalesPrice,b.stockId=b.specification[d].StockId)},b.shoppingCart=function(){b.getItem.ProductSize=b.size,b.getItem.ProductColor=b.color,c.totalPrice+=b.getItem.SalesPrice*b.getItem.quantity,c.totalPrice>0?c.free=300:c.free=0;var e={StoreId:b.storeId,ProductId:b.id,ListPrice:b.getItem.Price,BuyerAccountId:b.Identity,ProductColor:b.getItem.ProductColor,ProductSize:b.getItem.ProductSize,Qty:b.getItem.quantity};a.post("http://"+g+"/Api/api/v1/me/ShoppingCart",e).success(function(){d.shoppingCart(b.Identity).success(function(a){c.listCart=a.Data,alertInfo.Success("成功加入购物车!")})}).error(function(){alertInfo.Error("加入购物车失败!")})},b.add=function(){b.getItem.quantity++},b.subtract=function(){b.getItem.quantity>1&&b.getItem.quantity--},b.getBack=function(){b.link="/sales/productList/"+b.getUrlId,f.url(b.link),b.getItem=[]}}]),MetronicApp.controller("ProductManagementController",function(a,b){b.get("../angularjs/data/Product.json").success(function(b){
a.product=b}).error(function(){})}),MetronicApp.controller("ShoppingCartController",["$scope","$http","$rootScope","SalesService","authService","apiUrl","$location","localStorageService","$timeout",function(a,b,c,d,e,f,g,h,i){function j(){d.shoppingCart(a.Identity).success(function(b){c.listCart=b.Data,c.totalPrice=0,a.deleteId=[],a.salesInfo=[];for(var d=0;d<c.listCart.length;d++){c.totalPrice+=c.listCart[d].ProductQty*c.listCart[d].SalesPrice;var e={ProductId:c.listCart[d].ProductId,ProductBarCode:c.listCart[d].ProductCode,ProductColor:c.listCart[d].ProductColor,ProductSize:c.listCart[d].ProductSize,Qty:c.listCart[d].ProductQty,PriceListId:c.listCart[d].PriceListId,ListPrice:c.listCart[d].ListPrice,SalesPrice:c.listCart[d].SalesPrice};a.salesInfo.push(e),a.deleteId.push(c.listCart[d].Id)}})}b.get("http://"+f+"/Api/api/v1/UserProfile").success(function(b){a.userInfo=b.Data,"null"==a.userInfo.ContactInfo&&(e.logOut(),g.url("/Login/login/html")),a.StoreInfo=JSON.parse(a.userInfo.StoreInfo),a.ContactInfo=JSON.parse(a.userInfo.ContactInfo),a.InvoiceInfo=JSON.parse(a.userInfo.InvoiceInfo),a.StoreInfo=JSON.parse(a.userInfo.StoreInfo),a.Identity=a.userInfo.Identity,a.storeId=a.StoreInfo.Id,a.invoiceInfoId=a.InvoiceInfo.Id,a.contactId=a.ContactInfo.Id,a.storeId=a.StoreInfo.Id,j()}),a.addList=function(a){c.listCart[a].ProductQty++,c.totalPrice=c.totalPrice+c.listCart[a].SalesPrice,b.put("http://"+f+"/Api/api/v1/me/shoppingCart",{ShoppingCartLineId:c.listCart[a].Id,Qty:c.listCart[a].ProductQty}).success(function(){j()}).error(function(){})},a.subtractList=function(a){c.listCart[a].ProductQty>1&&(c.listCart[a].ProductQty--,c.totalPrice=c.totalPrice-c.listCart[a].SalesPrice,b.put("http://"+f+"/Api/api/v1/me/shoppingCart",{ShoppingCartLineId:c.listCart[a].Id,Qty:c.listCart[a].ProductQty}).success(function(){j()}).error(function(){}))},a.deleteList=function(a){b.put("http://"+f+"/Api/api/v1/me/ShoppingCart/Delete",[c.listCart[a].Id]).success(function(){j(),alertInfo.Success("删除成功!")}).error(function(){alertInfo.Error("删除失败!")})},a.submitList=function(){d.shoppingCart(a.Identity).success(function(d){c.listCart=d.Data,c.totalPrice=0,a.deleteId=[],a.salesInfo=[];for(var e=0;e<c.listCart.length;e++){c.totalPrice+=c.listCart[e].ProductQty*c.listCart[e].SalesPrice;var i={ProductId:c.listCart[e].ProductId,ProductBarCode:c.listCart[e].ProductCode,ProductColor:c.listCart[e].ProductColor,ProductSize:c.listCart[e].ProductSize,Qty:c.listCart[e].ProductQty,PriceListId:c.listCart[e].PriceListId,ListPrice:c.listCart[e].ListPrice,SalesPrice:c.listCart[e].SalesPrice};a.salesInfo.push(i),a.deleteId.push(c.listCart[e].Id)}var j={Identity:a.Identity,ContactId:a.contactId,InvoiceInfoId:a.invoiceInfoId,StoreId:a.storeId,SalesOrderLineInfos:a.salesInfo};b.post("http://"+f+"/Api/api/v1/me/ShoppingCart/IntoSalesOrder",j).success(function(d){a.salesId=d.Data,h.set("salesOrderId",a.salesId),b.put("http://"+f+"/Api/api/v1/me/ShoppingCart/Delete",a.deleteId).success(function(){c.listCart=[]}).error(function(){}),alertInfo.Success("提交成功!"),g.path("/sales/shopCheckOut.html").replace()}).error(function(){alertInfo.Error("提交失败!")})})}}]),MetronicApp.controller("SignUpController",["$http","$scope","$location","$timeout","authService",function(a,b,c,d,e){b.savedSuccessfully=!1,b.message="",b.registration={Email:"",password:"",confirmPassword:""},b.signUp=function(){e.saveRegistration(b.registration).then(function(a){b.savedSuccessfully=!0,b.message="注册成功！2秒中后跳转到登录页面",f()},function(a){var c=[];for(var d in a.data.modelState)for(var e=0;e<a.data.modelState[d].length;e++)c.push(a.data.modelState[d][e]);b.message="注册失败:"+c.join(" ")})};var f=function(){var a=d(function(){d.cancel(a),c.path("/login")},2e3)}}]),MetronicApp.controller("UserProfileController",function(a,b,c,d,e,f,g){a.loginName=c.authentication.userName,d.headImg=e.get(a.loginName+"image"),b.get("http://"+f+"/Api/api/v1/UserProfile").success(function(b){a.userInfo=b.Data,"null"==a.userInfo.ContactInfo&&(c.logOut(),g.url("/Login/login/html")),d.Nick=JSON.parse(a.userInfo.ContactInfo).Nick}).error(function(){c.logOut(),g.url("/Login/login/html")}),b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/userData1.json").success(function(b){a.pageData=b.data1,a.dataLenth=0;for(var c=0;c<a.pageData.length;c++)a.dataLenth=a.dataLenth+a.pageData[c];a.pageData2=b.data2,a.dataLenth2=0;for(var d=0;d<a.pageData2.length;d++)a.dataLenth2=a.dataLenth2+a.pageData2[d]}),b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/Member1.json").success(function(b){a.Member=b}),a.timeClick=function(c){b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/userData"+c+".json").success(function(b){a.pageData=b.data1,a.dataLenth=0;for(var c=0;c<a.pageData.length;c++)a.dataLenth=a.dataLenth+a.pageData[c];a.pageData2=b.data2,a.dataLenth2=0;for(var d=0;d<a.pageData2.length;d++)a.dataLenth2=a.dataLenth2+a.pageData2[d]}),b.get("/itecDrpWeb/templates/itecDrp/angularjs/data/Member"+c+".json").success(function(b){a.Member=b}),sparkLineInit.init(c)}});