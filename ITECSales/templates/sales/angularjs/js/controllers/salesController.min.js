/*! test 05-04-2016 */
MetronicApp.controller("CheckOutController",["SalesService","localStorageService","$timeout","$http","$scope","$rootScope","$location","apiUrl","authService",function(a,b,c,d,e,f,g,h,i){function j(){var a={SalesOrderId:e.salesOrderId,BuyerId:e.Identity,PageIndex:0,PageSize:0};d.put("http://"+h+"/Api/api/v1/me/SalesOrders/Submitted",a).success(function(a){if(e.orderInfo=a.Data,""!=e.orderInfo){e.orderId=e.orderInfo[0].Id,e.totalPrice=0;for(var b=0;b<e.orderInfo[0].SalesOrderLines.length;b++)e.totalPrice+=e.orderInfo[0].SalesOrderLines[b].ProductQty*e.orderInfo[0].SalesOrderLines[b].SalesPrice,e.orderInfo[0].SalesOrderLines[b].showBtn=!1}else g.path("/sales/productList.html")})}e.loginName=i.authentication.userName,e.salesOrderId=b.get("salesOrderId"),d.get("http://"+h+"/Api/api/v1/UserProfile").success(function(a){e.userInfo=a.Data,console.log(e.userInfo),"null"==e.userInfo.ContactInfo&&(i.logOut(),g.url("/Login/login/html")),e.Identity=e.userInfo.Identity,e.StoreInfo=JSON.parse(e.userInfo.StoreInfo),e.storeId=e.StoreInfo.Id,e.MainAddressInfo=JSON.parse(e.userInfo.MainAddressInfo),e.AddressInfo=JSON.parse(e.userInfo.AddressInfo);for(var b=0;b<e.AddressInfo.length;b++)e.AddressInfo[b].contact=JSON.parse(e.AddressInfo[b].StrExt2),e.AddressInfo[b].Name==e.MainAddressInfo[0].Name&&(e.AddressInfo.unshift(e.AddressInfo[b]),e.AddressInfo.splice(b+1,1));j()}),e.info=0,e.checkAddress=function(a,b){var c=a.Id;e.info=b,d.put("http://"+h+"/Api/api/v1/me/SalesOrders/"+e.Identity+"/"+e.salesOrderId+"/ConsigneeAddress/"+c).success(function(){}).error(function(){})},e.isShow=!1,e.ShowDropDown=function(){e.isShow=!e.isShow},e.showButton=function(a){e.orderInfo[0].SalesOrderLines[a].showBtn=!0},e.hideButton=function(a){e.orderInfo[0].SalesOrderLines[a].showBtn=!1},e.backShoppingCart=function(b){var c={StoreId:e.storeId,BuyerAccountId:e.Identity,ProductId:b.ProductId,ListPrice:b.ListPrice,ProductColor:b.ProductColor,ProductSize:b.ProductSize,Qty:b.ProductQty};d.post("http://"+h+"/Api/api/v1/me/ShoppingCart",c).success(function(){d.put("http://"+h+"/Api/api/v1/me/SalesOrders/Delete/Lines/"+b.Id).success(function(){a.shoppingCart(e.Identity).success(function(a){f.listCart=a.Data,j(),alertInfo.Success("移入购物车成功!")}).error(function(){alertInfo.Error("移入购物车失败")})}).error(function(){alertInfo.Error("删除失败")})}).error(function(){alertInfo.Error("移入购物车失败!")})},e.add=function(a){e.orderInfo[0].SalesOrderLines[a].ProductQty++;var b={SalesOrderLineId:e.orderInfo[0].SalesOrderLines[a].Id,Qty:e.orderInfo[0].SalesOrderLines[a].ProductQty,UserIdentity:e.Identity};d.put("http://"+h+"/Api/api/v1/me/SalesOrders/LinesQty",b).success(function(){e.totalPrice+=e.orderInfo[0].SalesOrderLines[a].SalesPrice}).error(function(){})},e.subtract=function(a){if(e.orderInfo[0].SalesOrderLines[a].ProductQty>1){e.orderInfo[0].SalesOrderLines[a].ProductQty--;var b={SalesOrderLineId:e.orderInfo[0].SalesOrderLines[a].Id,Qty:e.orderInfo[0].SalesOrderLines[a].ProductQty,UserIdentity:e.Identity};d.put("http://"+h+"/Api/api/v1/me/SalesOrders/LinesQty",b).success(function(){e.totalPrice-=e.orderInfo[0].SalesOrderLines[a].SalesPrice}).error(function(){})}},e.cancelSalesOrder=function(){d["delete"]("http://"+h+"/Api/api/v1/me/SalesOrders/"+e.orderId).success(function(){alertInfo.Success("取消成功!"),g.url("/sales/productList/all")}).error(function(){alertInfo.Error("取消失败")})},e.confirmSalesOrder=function(){d.put("http://"+h+"/Api/api/v1/me/SalesOrders/"+e.Identity+"/ConfirmSalesOrder/"+e.orderId).success(function(){alertInfo.Success("确认成功!"),g.url("/sales/payment.html"),f.orderLength++})}}]),MetronicApp.controller("MyOrderListController",["authService","ListService","$scope","apiUrl","$http","localStorageService","$location",function(a,b,c,d,e,f,g){e.get("http://"+d+"/Api/api/v1/UserProfile").success(function(d){c.userInfo=d.Data,"null"==c.userInfo.ContactInfo&&(a.logOut(),g.url("/Login/login/html")),c.Identity=c.userInfo.Identity,c.StoreInfo=JSON.parse(c.userInfo.StoreInfo),c.storeId=c.StoreInfo.Id,c.MainAddressInfo=JSON.parse(c.userInfo.MainAddressInfo),c.ContactWay=JSON.parse(c.MainAddressInfo[0].StrExt2),c.orderPayInfo=[],c.orderDeliverInfo=[],b.totalOrders(c.Identity).success(function(a){c.orderInfo=a.Data,console.log(a.Data);for(var b=0;b<c.orderInfo.length;b++)c.orderInfo[b].Status<3?c.orderPayInfo.push(c.orderInfo[b]):c.orderInfo[b].Status<=128&&c.orderDeliverInfo.push(c.orderInfo[b]);c.listCount=c.orderInfo.slice(0,10),c.totalPage=Math.ceil(c.orderInfo.length/10),c.salesOrderLine=c.orderInfo.SalesOrderLines}),e.get("../angularjs/data/package.json").success(function(a){c.orderReviewInfo=a})}),c.isShow=!1,c.ShowDropDown=function(){c.isShow=!c.isShow},c.confirmPay=function(a){e.put("http://"+d+"/Api/api/v1/me/SalesOrders/"+c.Identity+"/PaidSalesOrder/"+c.orderPayInfo[a].Id).success(function(){c.orderPayInfo.splice(a,1),alertInfo.Success("付款成功!"),b.deliveryOrders(c.Identity).success(function(a){c.orderDeliverInfo=a.Data})}).error(function(){alertInfo.Error("付款失败!")})},c.confirmDeliver=function(a){e.put("http://"+d+"/Api/api/v1/me/SalesOrders/"+c.Identity+"/FinishedSalesOrder/"+c.orderDeliverInfo[a].Id).success(function(){c.orderDeliverInfo.splice(a,1),alertInfo.Success("收货成功!")}).error(function(){alertInfo.Error("收货失败!")})},c.confirmReceive=function(a){},c.viewOrderDetail=function(a){var b=a.Status,c=0;switch(b){case 1:case 2:c=1;break;case 4:case 8:case 16:case 32:case 64:case 128:c=2;break;case 256:c=3;break;case 512:c=4}f.set("listData",a),f.set("currentStatus",c),g.path("/sales/orderDetail.html")},c.items=[{Name:"全部订单",status:0},{Name:"待付款",status:2},{Name:"待发货",status:4},{Name:"待收货",status:32}],c.item=c.items[0],c.status=c.item.status,c.changeStatus=function(a){c.status=a.status},c.searchProduct=function(){var a={BuyerId:c.Identity,Status:c.status,DateFrom:c.dateFrom,DateTo:c.dateTo,ProductName:c.productName,ProductCode:c.productCode,SalesOrderId:c.salesOrderId};e.put("http://"+d+"/Api/api/v1/me/SalesOrders/GetLines",a).success(function(a){c.searchResult=a.Data})},c.saveReview=function(){var a={UserId:c.Identity,RefTypeStr:"订单",RefId:c.orderLineRev.Id,LineId:c.orderLineRev.CatalogId,Comments:c.reviewText,ParentId:0};e.post("http://"+d+"/Api/api/v1/me/Comments",a).success(function(){c.reviewName="",c.reviewText="",c.reviewTel="",alertInfo.Success("保存成功!")}).error(function(){alertInfo.Error("保存失败!")})},c.currentPage=1,c.pageSize=10,c.pages=[1,2,3,4,5],c.setPage=function(a,b){c.listCount=c.orderInfo.slice((a-1)*b,a*b),c.currentPage<=5&&(c.pages=[1,2,3,4,5]),c.currentPage>5&&(c.pages=[c.currentPage-4,c.currentPage-3,c.currentPage-2,c.currentPage-1,c.currentPage])},c.next=function(){c.currentPage<c.totalPage&&(c.currentPage++,c.setPage(c.currentPage,c.pageSize))},c.prev=function(){c.currentPage>1&&(c.currentPage--,c.setPage(c.currentPage,c.pageSize))},c.loadPage=function(a){c.currentPage=a,c.setPage(c.currentPage,c.pageSize)}}]),MetronicApp.controller("OrderDetailController",["$http","$scope","localStorageService",function(a,b,c){var d=c.get("currentStatus");b.List=c.get("listData");var e=b.List.ConsignneInfo,f=e.lastIndexOf("}");if(-1!=f){var g=JSON.parse(e.substring(0,f+1));b.List.ConsignneInfo=e.substring(f+1),b.List.ConsigneeTel=g.Tel,b.List.ConsigneePhone=g.Phone}b.total=0;for(var h=0;h<b.List.SalesOrderLines.length;h++)b.total+=b.List.SalesOrderLines[h].ProductQty*b.List.SalesOrderLines[h].SalesPrice;FormWizard.init(d)}]),MetronicApp.controller("PaymentController",["$http","$scope",function(a,b){}]),MetronicApp.controller("ProductController",["authService","SalesService","apiUrl","$scope","$rootScope","$http","$timeout","$location","$stateParams","localStorageService",function(a,b,c,d,e,f,g,h,i,j){d.loginName=a.authentication.userName,f.get("http://"+c+"/Api/api/v1/UserProfile").success(function(c){d.userInfo=c.Data,"null"==d.userInfo.ContactInfo&&(a.logOut(),h.url("/Login/login/html")),d.Identity=d.userInfo.Identity,j.set("Identity",d.Identity),d.StoreInfo=JSON.parse(d.userInfo.StoreInfo),d.storeId=d.StoreInfo.Id,j.set("storeId",d.storeId),b.shoppingCart(d.Identity).success(function(a){e.listCart=a.Data})}),f.get("http://"+c+"/Api/api/v1/ProductCatalog").success(function(a){d.itemList=a.Data;for(var b=0;b<d.itemList.length;b++)d.itemList[b].quantity=1;switch(d.listId=i.listType,d.FilterItem=[],d.getFilterItem=function(a){for(var b=0;b<d.itemList.length;b++)d.itemList[b].CatalogId==a&&d.FilterItem.push(d.itemList[b])},d.listId){case"all":d.FilterItem=d.itemList;break;case"4430":d.getFilterItem("4430");break;case"4431":d.getFilterItem("4431");break;case"4432":d.getFilterItem("4432");break;case"4433":d.getFilterItem("4433");break;case"4434":d.getFilterItem("4434");break;case"4435":d.getFilterItem("4435");break;case"4436":d.getFilterItem("4436");break;case"4437":d.getFilterItem("4437");break;case"4438":d.getFilterItem("4438");break;case"4439":d.getFilterItem("4439");break;case"4440":d.getFilterItem("4440");break;case"4441":d.getFilterItem("4441");break;case"4442":d.getFilterItem("4442");break;case"4443":d.getFilterItem("4443");break;case"4444":d.getFilterItem("4444");break;case"4445":d.getFilterItem("4445");break;case"4446":d.getFilterItem("4446");break;case"4447":d.getFilterItem("4447");break;case"4448":d.getFilterItem("4448");break;case"4449":d.getFilterItem("4449");break;case"4450":d.getFilterItem("4450");break;case"4451":d.getFilterItem("4451");break;case"4452":d.getFilterItem("4452");break;case"4453":d.getFilterItem("4453");break;case"4454":d.getFilterItem("4454");break;case"4455":d.getFilterItem("4455");break;case"4456":d.getFilterItem("4456");break;default:d.FilterItem=d.itemList}d.len=d.FilterItem.length,d.totalPage=Math.ceil(d.len/d.pageSize),d.listCount=d.FilterItem.slice(0,d.pageSize)}),d.viewDetail=function(a){d.productItem=a,f.get("http://"+c+"/Api/api/v1/ProductCatalog/"+a.CatalogId+"/"+d.storeId+"/Products").success(function(a){d.specification=a.Data,d.ProductColor=[],d.ProductSize=[],d.Stock=[],d.ProductId=[],d.Price=[],d.SalesPrice=[];for(var b=0;b<d.specification.length;b++)null!=d.specification[b].ProductColor&&d.ProductColor.push(d.specification[b].ProductColor),d.ProductSize.push(d.specification[b].ProductSize),d.Stock.push(d.specification[b].StockQty),d.ProductId.push(d.specification[b].ProductId),d.Price.push(d.specification[b].Price),d.SalesPrice.push(d.specification[b].SalesPrice);d.ProductSize=Enumerable.From(d.ProductSize).Distinct().ToArray(),d.ProductColor=Enumerable.From(d.ProductColor).Distinct().ToArray(),d.color=d.ProductColor[0],d.size=d.ProductSize[0],d.stockQty=d.Stock[0],d.id=d.ProductId[0],d.price=d.Price[0],d.SalesPrice=d.SalesPrice[0]})},d.changeSize=function(a){d.getSize=a,d.ProductColor=[],d.Stock=[],d.ProductId=[],d.Price=[],d.SalesPrice=[];for(var b=0;b<d.specification.length;b++)d.specification[b].ProductSize==a&&(null!=d.specification[b].ProductColor&&d.ProductColor.push(d.specification[b].ProductColor),d.Stock.push(d.specification[b].StockQty),d.ProductId.push(d.specification[b].ProductId),d.Price.push(d.specification[b].Price),d.SalesPrice.push(d.specification[b].SalesPrice));d.ProductColor=Enumerable.From(d.ProductColor).Distinct().ToArray(),d.color=d.ProductColor[0],d.stockQty=d.Stock[0],d.id=d.ProductId[0],d.price=d.Price[0],d.SalesPrice=d.SalesPrice[0]},d.changeColor=function(a){if(d.getColor=a,d.Stock=[],d.ProductId=[],null==d.getSize)for(var b=0;b<d.specification.length;b++)d.specification[b].ProductColor==a&&(d.specification[b].ProductSize==d.size?(d.stockQty=d.specification[b].StockQty,d.id=d.specification[b].ProductId,d.price=d.specification[b].Price,d.SalesPrice=d.specification[b].SalesPrice,d.stockId=d.specification[b].StockId):(d.size=d.specification[b].ProductSize,d.stockQty=d.specification[b].StockQty,d.id=d.specification[b].ProductId,d.price=d.specification[b].Price,d.SalesPrice=d.specification[b].SalesPrice,d.stockId=d.specification[b].StockId));else for(var c=0;c<d.specification.length;c++)d.specification[c].ProductSize==d.getSize&&d.specification[c].ProductColor==a&&(d.stockQty=d.specification[c].StockQty,d.id=d.specification[c].ProductId,d.price=d.specification[c].Price,d.SalesPrice=d.specification[c].SalesPrice,d.stockId=d.specification[c].StockId)},d.shoppingCart=function(){d.productItem.ProductSize=d.size,d.productItem.ProductColor=d.color;var a={StoreId:d.storeId,ProductId:d.id,ListPrice:d.productItem.Price,BuyerAccountId:d.Identity,ProductColor:d.productItem.ProductColor,ProductSize:d.productItem.ProductSize,Qty:d.productItem.quantity};f.post("http://"+c+"/Api/api/v1/me/ShoppingCart",a).success(function(){b.shoppingCart(d.Identity).success(function(a){e.listCart=a.Data,alertInfo.Success("成功加入购物车!")})}).error(function(){alertInfo.Error("加入购物车失败!")})},d.addToCart=function(a){var g={StoreId:d.storeId,ProductId:a.ProductId,ListPrice:a.Price,BuyerAccountId:d.Identity,ProductColor:a.ProductColor,ProductSize:a.ProductSize,Qty:a.quantity};f.post("http://"+c+"/Api/api/v1/me/ShoppingCart",g).success(function(){b.shoppingCart(d.Identity).success(function(a){e.listCart=a.Data,alertInfo.Success("成功加入购物车!")})}).error(function(){alertInfo.Error("加入购物车失败!")})},d.selectedList="ProductId",d.add=function(){d.productItem.quantity++},d.subtract=function(){d.productItem.quantity>1&&d.productItem.quantity--},d.showPageSize=[{pageSize:12},{pageSize:24},{pageSize:36},{pageSize:48},{pageSize:60}],d.pageSize=d.showPageSize[0].pageSize,d.pageChange=function(){d.listCount=d.FilterItem.slice(0,d.pageSize)},d.currentPage=1,d.pages=[1,2,3,4,5],d.setPage=function(a,b){d.listCount=d.FilterItem.slice((a-1)*b,a*b),d.currentPage<=5&&(d.pages=[1,2,3,4,5]),d.currentPage>5&&(d.pages=[d.currentPage-4,d.currentPage-3,d.currentPage-2,d.currentPage-1,d.currentPage])},d.next=function(){d.currentPage<d.totalPage&&(d.currentPage++,d.setPage(d.currentPage,d.pageSize))},d.prev=function(){d.currentPage>1&&(d.currentPage--,d.setPage(d.currentPage,d.pageSize))},d.loadPage=function(a){d.currentPage=a,d.setPage(d.currentPage,d.pageSize)},d.getListItem=function(a){a.listId=d.listId,j.set("item",a),d.link="/sales/productDetail.html",h.url(d.link)}}]),MetronicApp.controller("ProductDetailController",["$http","$scope","$rootScope","SalesService","$timeout","$location","apiUrl","localStorageService",function(a,b,c,d,e,f,g,h){b.getItem=h.get("item"),b.getUrlId=b.getItem.listId,b.storeId=h.get("storeId"),b.Identity=h.get("Identity"),d.shoppingCart(b.Identity).success(function(a){c.listCart=a.Data}),a.get("http://"+g+"/Api/api/v1/ProductCatalog/"+b.getItem.CatalogId+"/"+b.storeId+"/Products").success(function(a){b.specification=a.Data,b.ProductColor=[],b.ProductSize=[],b.Stock=[],b.ProductId=[],b.Price=[],b.SalesPrice=[];for(var c=0;c<b.specification.length;c++)null!=b.specification[c].ProductColor&&b.ProductColor.push(b.specification[c].ProductColor),b.ProductSize.push(b.specification[c].ProductSize),b.Stock.push(b.specification[c].StockQty),b.ProductId.push(b.specification[c].ProductId),b.Price.push(b.specification[c].Price),b.SalesPrice.push(b.specification[c].SalesPrice);b.ProductSize=Enumerable.From(b.ProductSize).Distinct().ToArray(),b.ProductColor=Enumerable.From(b.ProductColor).Distinct().ToArray(),b.color=b.ProductColor[0],b.size=b.ProductSize[0],b.stockQty=b.Stock[0],b.id=b.ProductId[0],b.price=b.Price[0],b.SalesPrice=b.SalesPrice[0]}),b.changeSize=function(a){b.getSize=a,b.ProductColor=[],b.Stock=[],b.ProductId=[],b.Price=[],b.SalesPrice=[];for(var c=0;c<b.specification.length;c++)b.specification[c].ProductSize==a&&(null!=b.specification[c].ProductColor&&b.ProductColor.push(b.specification[c].ProductColor),b.Stock.push(b.specification[c].StockQty),b.ProductId.push(b.specification[c].ProductId),b.Price.push(b.specification[c].Price),b.SalesPrice.push(b.specification[c].SalesPrice));b.ProductColor=Enumerable.From(b.ProductColor).Distinct().ToArray(),b.color=b.ProductColor[0],b.stockQty=b.Stock[0],b.id=b.ProductId[0],b.price=b.Price[0],b.SalesPrice=b.SalesPrice[0]},b.changeColor=function(a){if(b.getColor=a,b.Stock=[],b.ProductId=[],null==b.getSize)for(var c=0;c<b.specification.length;c++)b.specification[c].ProductColor==a&&(b.specification[c].ProductSize==b.size?(b.stockQty=b.specification[c].StockQty,b.id=b.specification[c].ProductId,b.price=b.specification[c].Price,b.SalesPrice=b.specification[c].SalesPrice,b.stockId=b.specification[c].StockId):(b.size=b.specification[c].ProductSize,b.stockQty=b.specification[c].StockQty,b.id=b.specification[c].ProductId,b.price=b.specification[c].Price,b.SalesPrice=b.specification[c].SalesPrice,b.stockId=b.specification[c].StockId));else for(var d=0;d<b.specification.length;d++)b.specification[d].ProductSize==b.getSize&&b.specification[d].ProductColor==a&&(b.stockQty=b.specification[d].StockQty,b.id=b.specification[d].ProductId,b.price=b.specification[d].Price,b.SalesPrice=b.specification[d].SalesPrice,b.stockId=b.specification[d].StockId)},b.shoppingCart=function(){b.getItem.ProductSize=b.size,b.getItem.ProductColor=b.color,c.totalPrice+=b.getItem.SalesPrice*b.getItem.quantity,c.totalPrice>0?c.free=300:c.free=0;var e={StoreId:b.storeId,ProductId:b.id,ListPrice:b.getItem.Price,BuyerAccountId:b.Identity,ProductColor:b.getItem.ProductColor,ProductSize:b.getItem.ProductSize,Qty:b.getItem.quantity};a.post("http://"+g+"/Api/api/v1/me/ShoppingCart",e).success(function(){d.shoppingCart(b.Identity).success(function(a){c.listCart=a.Data,alertInfo.Success("成功加入购物车!")})}).error(function(){alertInfo.Error("加入购物车失败!")})},b.add=function(){b.getItem.quantity++},b.subtract=function(){b.getItem.quantity>1&&b.getItem.quantity--},b.getBack=function(){b.link="/sales/productList/"+b.getUrlId,f.url(b.link),b.getItem=[]}}]),MetronicApp.controller("ShoppingCartController",["$scope","$http","$rootScope","SalesService","authService","apiUrl","$location","localStorageService","$timeout",function(a,b,c,d,e,f,g,h,i){function j(){d.shoppingCart(a.Identity).success(function(b){c.listCart=b.Data,c.totalPrice=0,a.deleteId=[],a.salesInfo=[];for(var d=0;d<c.listCart.length;d++){c.totalPrice+=c.listCart[d].ProductQty*c.listCart[d].SalesPrice;var e={ProductId:c.listCart[d].ProductId,ProductBarCode:c.listCart[d].ProductCode,ProductColor:c.listCart[d].ProductColor,ProductSize:c.listCart[d].ProductSize,Qty:c.listCart[d].ProductQty,PriceListId:c.listCart[d].PriceListId,ListPrice:c.listCart[d].ListPrice,SalesPrice:c.listCart[d].SalesPrice};a.salesInfo.push(e),a.deleteId.push(c.listCart[d].Id)}})}b.get("http://"+f+"/Api/api/v1/UserProfile").success(function(b){a.userInfo=b.Data,"null"==a.userInfo.ContactInfo&&(e.logOut(),g.url("/Login/login/html")),a.StoreInfo=JSON.parse(a.userInfo.StoreInfo),a.ContactInfo=JSON.parse(a.userInfo.ContactInfo),a.InvoiceInfo=JSON.parse(a.userInfo.InvoiceInfo),a.StoreInfo=JSON.parse(a.userInfo.StoreInfo),a.Identity=a.userInfo.Identity,a.storeId=a.StoreInfo.Id,a.invoiceInfoId=a.InvoiceInfo.Id,a.contactId=a.ContactInfo.Id,a.storeId=a.StoreInfo.Id,j()}),a.addList=function(a){c.listCart[a].ProductQty++,c.totalPrice=c.totalPrice+c.listCart[a].SalesPrice,b.put("http://"+f+"/Api/api/v1/me/shoppingCart",{ShoppingCartLineId:c.listCart[a].Id,Qty:c.listCart[a].ProductQty}).success(function(){j()}).error(function(){})},a.subtractList=function(a){c.listCart[a].ProductQty>1&&(c.listCart[a].ProductQty--,c.totalPrice=c.totalPrice-c.listCart[a].SalesPrice,b.put("http://"+f+"/Api/api/v1/me/shoppingCart",{ShoppingCartLineId:c.listCart[a].Id,Qty:c.listCart[a].ProductQty}).success(function(){j()}).error(function(){}))},a.deleteList=function(a){b.put("http://"+f+"/Api/api/v1/me/ShoppingCart/Delete",[c.listCart[a].Id]).success(function(){j(),alertInfo.Success("删除成功!")}).error(function(){alertInfo.Error("删除失败!")})},a.submitList=function(){d.shoppingCart(a.Identity).success(function(d){c.listCart=d.Data,c.totalPrice=0,a.deleteId=[],a.salesInfo=[];for(var e=0;e<c.listCart.length;e++){c.totalPrice+=c.listCart[e].ProductQty*c.listCart[e].SalesPrice;var i={ProductId:c.listCart[e].ProductId,ProductBarCode:c.listCart[e].ProductCode,ProductColor:c.listCart[e].ProductColor,ProductSize:c.listCart[e].ProductSize,Qty:c.listCart[e].ProductQty,PriceListId:c.listCart[e].PriceListId,ListPrice:c.listCart[e].ListPrice,SalesPrice:c.listCart[e].SalesPrice};a.salesInfo.push(i),a.deleteId.push(c.listCart[e].Id)}var j={Identity:a.Identity,ContactId:a.contactId,InvoiceInfoId:a.invoiceInfoId,StoreId:a.storeId,SalesOrderLineInfos:a.salesInfo};b.post("http://"+f+"/Api/api/v1/me/ShoppingCart/IntoSalesOrder",j).success(function(d){a.salesId=d.Data,h.set("salesOrderId",a.salesId),b.put("http://"+f+"/Api/api/v1/me/ShoppingCart/Delete",a.deleteId).success(function(){c.listCart=[]}).error(function(){}),alertInfo.Success("提交成功!"),g.path("/sales/shopCheckOut.html").replace()}).error(function(){alertInfo.Error("提交失败!")})})}}]);