/*! test 05-04-2016 */
"use strict";MetronicApp.factory("authInterceptorService",["$q","$location","localStorageService",function(a,b,c){var d={},e=function(a){a.headers=a.headers||{};var b=c.get("authorizationData");return b&&(a.headers.Authorization="Bearer "+b.token),a},f=function(c){return 401===c.status&&b.path("/Login/login.html"),a.reject(c)};return d.request=e,d.responseError=f,d}]),MetronicApp.factory("authService",["$http","$q","localStorageService",function(a,b,c){var d="http://192.168.1.10:8083/",e={},f={isAuth:!1,userName:""},g=function(b){return i(),a.post(d+"api/account/register",b).then(function(a){return a})},h=function(e){var g="grant_type=password&username="+e.userName+"&password="+e.password,h=b.defer();return a.post(d+"token",g,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){c.set("authorizationData",{token:a.access_token,userName:e.userName}),f.isAuth=!0,f.userName=e.userName,h.resolve(a)}).error(function(a,b){i(),h.reject(a)}),h.promise},i=function(){c.remove("authorizationData"),f.isAuth=!1,f.userName=""},j=function(){var a=c.get("authorizationData");a&&(f.isAuth=!0,f.userName=a.userName)};return e.saveRegistration=g,e.login=h,e.logOut=i,e.fillAuthData=j,e.authentication=f,e}]),MetronicApp.factory("ordersService",["$http",function(a){var b="http://192.168.1.48:8081/",c={},d=function(){return a.get(b+"api/orders").then(function(a){return a})};return c.getOrders=d,c}]),MetronicApp.service("SalesService",["$http","apiUrl",function(a,b){this.shoppingCart=function(c){return a({method:"GET",url:"http://"+b+"/Api/api/v1/me/ShoppingCart/"+c})}}]),MetronicApp.service("ListService",["$http","apiUrl",function(a,b){this.totalOrders=function(c){var d={SalesOrderId:0,BuyerId:c,PageIndex:0,PageSize:0};return a({method:"put",url:"http://"+b+"/Api/api/v1/me/SalesOrders",data:d,cache:!0})},this.payingOrders=function(c){var d={SalesOrderId:0,BuyerId:c,PageIndex:0,PageSize:0};return a({method:"put",url:"http://"+b+"/Api/api/v1/me/SalesOrders/Paying",data:d,cache:!0})},this.deliveryOrders=function(c){var d={SalesOrderId:0,BuyerId:c,PageIndex:0,PageSize:0};return a({method:"put",url:"http://"+b+"/Api/api/v1/me/SalesOrders/Delivering",data:d,cache:!0})}}]),MetronicApp.factory("CatalogFactory",["$http","$q","apiUrl",function(a,b,c){var d={};return d.getCategory=function(){var d=b.defer();return a.get("http://"+c+"/Api/api/v1/ProductCategory",{cache:!0}).success(function(a){for(var b=a.Data,c=[],e=0;e<b.length;e++)if(0==b[e].ParentCode&&b[e].Id<1e4){b[e].module=[];for(var f=0;f<b.length;f++)b[e].Id==b[f].ParentCode&&(b[f].url="#/sales/productList/"+b[f].Id,b[e].module.push(b[f]));c.push(b[e])}d.resolve(c)}).error(function(){d.reject("获取失败")}),d.promise},d}]);